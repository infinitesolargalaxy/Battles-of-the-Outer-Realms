<?xml version="1.0" encoding="UTF-8"?>

<TranscendenceModule>
	<!-- Aquila II-class Cruiser -->
	;Aquila Cruiser equipped to use more of it's turret mounts.
	
	<ShipClass UNID="&scAquilaCruiser2;"
			manufacturer=		"Pacific Defense Corporation"
			class=				"Aquila II"
			type=				"cruiser"
			
			score=				"3300"
			mass=				"10000"
			cargoSpace=			"1000"
			thrustRatio=		"1"
			maxSpeed=			"17"

			cyberDefenseLevel=	"8"
			explosionType=		"&vtThermoExplosion2;"
			leavesWreck=		"100"

			attributes=			"capitalShip, commonwealth, commonwealthFleet, commonwealthMilitary, genericClass"
			>

		<Armor
			armorID=			"&itP210HexphaseArmor;"
			count=				"16"
			/>

		<Devices>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="355" maxFireArc="175" posAngle="99" posRadius="22"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="160" maxFireArc="5" posAngle="261" posRadius="22"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="355" maxFireArc="175" posAngle="126" posRadius="66"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="160" maxFireArc="5" posAngle="234" posRadius="66"/>
			<Device deviceID="&itTeV9PD;"/>
			<Device deviceID="&itTeV9PD;" posAngle="0" posRadius="60" />
			<Device deviceID="&itNAMIHeavyLauncher;" omnidirectional="true"/>
			<Device deviceID="&vtDamageControlParty;"/>
			<Device deviceID="&itR13Deflector;"/>
		</Devices>
		
		 <Interior>
                        <Compartment name="interior"
                                        hitPoints=        "300"
                                        />
                        
                        <Compartment name="main drive"
                                        type=                "mainDrive"
                                        hitPoints=        "150"

                                        posX=                "-75"
                                        posY=                "0"
                                        sizeX=                "42"
                                        sizeY=                "56"
                                        />
                </Interior>

		<Image imageID="&rsLargeShips1;" imageX="1728" imageY="0" imageWidth="192" imageHeight="192" imageFrameCount="0" imageTicksPerFrame="0"/>
		
		<Maneuver
			rotationCount=		"20"
			maxRotationRate=	"3.5"
			rotationAccel=		"1.0"
			/>
			
		<Effects>
			<Effect type="thrustMain"		posAngle="168"	posRadius="82"	posZ="-20"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="-168"	posRadius="82"	posZ="-20"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="180"	posRadius="82"	posZ="-5"	rotation="180"	effect="&efMainThrusterLarge;"/>
		</Effects>

		<Items>
			<Item count="5d24" item="&itM5Missile;"/>
		</Items>

		<AISettings
			fireRateAdj=		"10"
			fireRangeAdj=		"120"
			fireAccuracy=		"95"
			perception=			"5"
			combatStyle=		"standOff"
			/>

	</ShipClass>
	
<!-- Aurochs Frigate -->
	;Due to high losses of scarabs, more Aurochs were fielded which led to high losses of Aurochs, 
	;so Fleet logistics overhauled many Aurochs with better engines, weapons, and armor. 
	;The new Aurochs was dubbed the Aurochs Frigate. It is cheaper in crew and fuel than an Aquila.
	;Aurochs Frigates were designed for small scale battles.
		
	<ShipClass UNID="&scAurochsFrigate;"
			manufacturer=		"Pacific Defense Corporation"
			class=				"Aurochs"
			type=				"frigate"
			score=				"2135"

			mass=				"8000"
			cargoSpace=			"3000"
			thrustRatio=		"1.5"
			maxSpeed=			"18"
			maneuver=			"8"
			cyberDefenseLevel=	"8"
			explosionType=		"&vtBlastExplosion4;"
			leavesWreck=		"90"

			attributes=			"commonwealth,commonFleet,commonMilitary,genericClass,freighter,capitalShip"
			>

		<Armor
			armorID=			"&itP210HexphaseArmor;"
			count=				"12"
			/>

		<Devices>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" minFireArc="330" maxFireArc="195" posAngle="34" posRadius="38"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" minFireArc="155" maxFireArc="30" posAngle="326" posRadius="38"/>
			<Device deviceID="&itThermoCannon;" secondaryWeapon="true" omnidirectional="true" posAngle="180" posRadius="10"/>		
			<Device deviceID="&itPlasmaShieldGenerator;"/>
			<Device deviceID="&itArmorRepairDevice;" />
			<Device deviceID="&itMissileDefense;" />
		</Devices>
		
		 <Interior>
                        <Compartment name="interior"
                                        hitPoints=        "150"
                                        />
						<Compartment name="main drive"
                                        type=                "mainDrive"
                                        hitPoints=        "50"

                                        posX=                "-22"
                                        posY=                "0"
                                        sizeX=                "52"
                                        sizeY=                "10"
                                        />
		</Interior>

		<Image imageID="&rsMediumShips3;" imageX="768" imageY="0" imageWidth="96" imageHeight="96" imageFrameCount="0" imageTicksPerFrame="0"/>

		<Items>
			<Item count="1d12" item="&itXenotiteFuelRod;"/>
			<Item count="50d3+100" item="&itThermoCannonShell;"/>
		</Items>

		<Names noArticle="true">
			CF Alpha-%0%0; CF Beta-%0%0; CF Gamma-%0%0;
			CF Delta-%0%0; CF Epsilon-%0%0; CF Zeta-%0%0;
			CF Eta-%0%0; CF Theta-%0%0; CF Iota-%0%0;
			CF Kappa-%0%0; CF Lambda-%0%0; CF Mu-%0%0;
			CF Nu-%0%0; CF Xi-%0%0; CF Omicron-%0%0;
			CF Pi-%0%0; CF Rho-%0%0; CF Sigma-%0%0;
			CF Tau-%0%0; CF Upsilon-%0%0; CF Phi-%0%0;
			CF Chi-%0%0; CF Psi-%0%0; CF Omega-%0%0
		</Names>
		
		<Maneuver
			rotationCount=		"20"
			maxRotationRate=	"5.0"
			rotationAccel=		"1"
			/>
			
			<Effects>
					<Effect type="thrustMain"		posAngle="157"	posRadius="43"	posZ="0"	rotation="180"	effect="&efMainThrusterLarge;"/>
					<Effect type="thrustMain"		posAngle="180"	posRadius="42"	posZ="10"	rotation="180"	effect="&efMainThrusterLarge;"/>
					<Effect type="thrustMain"		posAngle="-157"	posRadius="43"	posZ="0"	rotation="180"	effect="&efMainThrusterLarge;"/>
			</Effects>
		
		<AISettings
			fireRateAdj=		"15"
			fireAccuracy=		"90"
			perception=			"5"
			combatStyle="standOff"	
			/>
	</ShipClass>
	
<!-- Britannia II-class Heavy Gunship -->
	;Fleet Labs and Fleet Special Operations upgraded existing Britannias in the Fleet with next-gen space superiority features:
	;advanced maneuver gyros, capital-ship grade armor, swivel mounted Katana, 2 NM900 Missile Pods integrated into the wings, and a new supercomputer for targeting.
	;Unfortunately, the supercomputer takes vast quantities of power for computing

	<ShipClass UNID="&scBritannia2;"
			manufacturer=		"Pacific Defense Corporation"
			class=				"Britannia II"
			type=				"heavy gunship"
			score=				"2100"
			
			mass=				"300"
			cargoSpace=			"50"
			thrustRatio=				"6.5"
			maxSpeed=			"24"

			leavesWreck=		"50"

			attributes=			"commonwealth,commonMilitary,genericClass"
			>

		<Armor
			armorID=			"&itP210HexphaseArmor;"
			count=				"4"
			/>

		<Devices>
			<Device deviceID="&itStarCannon;" minFireArc="355" maxFireArc="5" posAngle="0" posRadius="20" />
			<Device deviceID="&itBushidoEnhancer;"/>
			<Device deviceID="&itNM900MissilePod;" secondaryWeapon="true" posRadius="30" posAngle="90" minFireArc="330" maxFireArc="30"/>
			<Device deviceID="&itNM900MissilePod;" secondaryWeapon="true" posRadius="30" posAngle="270" minFireArc="330" maxFireArc="30"/>
			<Device deviceID="&it500MWReactor;"/>
			<Device deviceID="&itR9Deflector;"/>
		</Devices>

		<Items>
			<Item count="3d6" item="&itPteracniumFuelRod;"/>
		</Items>
		
		<Events>
		<OnCreate>
		(block Nil
		;Infinite Ammo
		(sysAddObjRecurringTimerEvent 2400 gSource "Reload")
		)
		</OnCreate>
			<Reload>
			(block (theMissilePod theMissilePod2)
					(setq theMissilePod (item (objGetItems gSource "lI") 0))
					(objFireItemEvent gSource theMissilePod "Reload")
					(setq theMissilePod2 (item (objGetItems gSource "lI") 1))
					(objFireItemEvent gSource theMissilePod2 "Reload")
					)
			</Reload>
		</Events>

		<Image imageID="&rsBritannia;" imageWidth="80" imageHeight="80"/>
		
		<Maneuver
			rotationCount=		"20"
			maxRotationRate=	"18.0"
			rotationAccel=		"3.0"
			/>
			
		<Effects>
			<Effect type="thrustMain"		posAngle="154"	posRadius="26"	posZ="0"	rotation="180"/>
			<Effect type="thrustMain"		posAngle="-154"	posRadius="26"	posZ="0"	rotation="180"/>
			<Effect type="rotateRight"		posAngle="82"	posRadius="23"	posZ="0"	rotation="0"/>
			<Effect type="rotateRight"		posAngle="-98"	posRadius="23"	posZ="0"	rotation="180"/>
			<Effect type="rotateLeft"		posAngle="-82"	posRadius="23"	posZ="0"	rotation="0"/>
			<Effect type="rotateLeft"		posAngle="98"	posRadius="23"	posZ="0"	rotation="180"/>
		</Effects>

		<AISettings
			fireRateAdj=		"10"
			fireAccuracy=		"95"
			ignoreShieldsDown=	"true"
			perception=			"6"
			noFriendlyFire="true"
			/>
	</ShipClass>
	
	<!-- TeV9 PD -->

	<ItemType UNID="&itTeV9PD;"
			name=				"TeV 9 Point Defense"
			level=				"8"
			value=				"40000"
			mass=				"1000"
			frequency=			"veryrare"
			attributes=			"MajorItem; Military"

			description=		"The standard point defense module used in the Commonwealth Fleet."
			>

		<Image imageID="&rsItems1;" imageX="0" imageY="192" imageWidth="96" imageHeight="96"/>

		<AutoDefenseDevice
				targetCriteria=		"msE N:30;"
				weapon=			"&vtICXTeV9;"
				fireRate=		"15"
				/>
	</ItemType>

	<!-- TeV 9 Blaster-->

	<ItemType UNID="&vtICXTeV9;"
			name=				"TeV 9 blaster"
			level=				"6"
			virtual=			"true" 
			>

		<Weapon
				type=				"beam"

				damage=				"particle:4d8"
				fireRate=			"15"
				lifetime=			"30"
				powerUse=			"400"

				effect=                                "&efParticleBeamDefault;"
				sound=				"&snLaserCannon;"
				>
		</Weapon>

	</ItemType>	
	
	<!-- R13 Deflector -->

	<ItemType UNID="&itR13Deflector;"
			name=				"R13 deflector"
			level=				"9"
			value=				"200000"
			mass=				"6500"
			attributes=			"MajorItem; Military; PacificDefense"
			frequency=			"rare"

			description=		"The R13 deflector was designed for the Fleet's new Aquila-II cruisers after the scandal over the original Aquila cruisers."
			>

		<Image imageID="&rsItems1;" imageX="192" imageY="0" imageWidth="96" imageHeight="96"/>

		<Shields
				hitPoints=		"500"
				hpBonus=		"  +0,  +0,  +0,  +0, +30, +30"
				regen=			"80"
				depletionDelay=	"360"
				powerUse=		"1800"
				/>

	</ItemType>
	
	<!-- Commonwealth Fleet Turret -->
	
	<StationType UNID="&stCommonFleetTurret;"
			name=				"Commonwealth Fleet turret"
			sovereign=			"&svCommonwealthFleet;"
			abandonedScreen=	"&dsAbandonedStation;"
			dockScreen=			"Main"
			noMapLabel=			"true"
			noFriendlyFire=			"true"
			canAttack=			"true"
			noBlackList=			"true"

			mass=				"2000"
			armorID=			"&itHeavyOrthoSteel;"
			hitPoints=			"300"
			repairRate=			"5"
			structuralHitPoints="50"
			fireRateAdj=		"10"
			ejectaType=			"&vtWreckEjecta;"
			>

			
		<ImageVariants>
			<Image			imageID="&rsStations4;" imageX="96" imageY="320" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="96" imageY="352" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="96" imageY="384" imageWidth="32" imageHeight="32"/>
			<Image			imageID="&rsStations4;" imageX="96" imageY="416" imageWidth="32" imageHeight="32"/>
		</ImageVariants>

		<Devices>
			<Device deviceID="&itStarCannon;"	omnidirectional="true"/>
			<Device deviceID="&itTeV9PD;"/>
		</Devices>

		<DockScreens>
			<Main>

				<Panes>
					<Default
							desc=	"You are docked at a Commonwealth Fleet Defense Turret; an upgraded Commonwealth Defense Turret. They are used to defend fleet assets in the Outer Realms.">

						<Actions>
							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>
			</Main>
		</DockScreens>

		<DockingPorts
				portCount=		"2"
				portRadius=		"24"
				maxDist=		"3"
				/>

	</StationType>
	
	<!-- Overwrites -->
	
	<!-- Centurion-class Heavy Gunship -->

	<ShipClass UNID="&scCenturion;"
			manufacturer=		"Pacific Defense Corporation"
			class=				"Centurion"
			type=				"heavy gunship"

			mass=				"250"
			cargoSpace=			"50"
			thrustRatio=				"5"
			maxSpeed=			"20"

			leavesWreck=		"50"

			attributes=			"commonwealth,commonMilitary,genericClass"
			>

		<Armor
			armorID=			"&itBlastPlate;"
			count=				"4"
			/>

		<Devices>
			<Table>
				<Group chance="70">
					<Table>
						<Device chance="20" deviceID="&itTeV9Blaster;"/>
						<Device chance="10" deviceID="&itTeV9Blaster;" minFireArc="355" maxFireArc="5"/>
						<Device chance="10" deviceID="&itTeV9Blaster;" minFireArc="350" maxFireArc="10"/>
						<Device chance="5" deviceID="&itTeV9Blaster;" minFireArc="345" maxFireArc="15"/>
						<Device chance="5" deviceID="&itTeV9Blaster;" minFireArc="340" maxFireArc="20"/>
						<Device chance="5" deviceID="&itTeV9Blaster;" minFireArc="335" maxFireArc="25"/>
						<Device chance="5" deviceID="&itTeV9Blaster;" minFireArc="330" maxFireArc="30"/>
						<Device chance="5" deviceID="&itTeV9Blaster;" omnidirectional="true"/>
						<Device chance="10" deviceID="&itDualTeV9Blaster;"/>
						<Device chance="10" deviceID="&itDualTeV9Blaster;" minFireArc="340" maxFireArc="20"/>
						<Device chance="15" deviceID="&itOmniTeV9Blaster;"/>
					</Table>
					<Table>
						<Device chance="35" deviceID="&itR1Deflector;"/>
						<Device chance="30" deviceID="&itR5Deflector;"/>
						<Device chance="25" deviceID="&itR5BDeflector;"/>
						<Device chance="10" deviceID="&itCydonianShields;"/>
					</Table>
					<Table>
						<Device chance=	"50" deviceID="&itParticleEnhancer;"/>		
					</Table>
				</Group>
				<Group chance="30">
					<Table>
						<Device	chance="50"	deviceID="&itLightningCannon;"/>
						<Device	chance="15"	deviceID="&itStarCannon;"/>
						<Device	chance="15"	deviceID="&itLightIonBlaster;"/>
						<Device	chance="15"	deviceID="&itTritiumCannon;"/>
						<Device	chance="10"	deviceID="&itMarkVHowitzer;"/>
					</Table>
					<Table>
						<Device chance="25" deviceID="&itR5Deflector;"/>
						<Device chance="25" deviceID="&itR5BDeflector;"/>
						<Device chance="15" deviceID="&itYoroiMX;"/>
						<Device chance="15" deviceID="&itCydonianShields;"/>
						<Device chance="10" deviceID="&itMammoth50Deflector;"/>
						<Device chance="5" deviceID="&itCydonianHeavyShields;"/>
						<Device chance="5"  deviceID="&itInvincibleDeflector;"/>
					</Table>
					;1 extra random upgrade
					<Table>
						<Device chance="50" deviceID="&itMissileDefense;"/>
						<Device chance="25" deviceID="&itArmorRepairDevice;"/>
						<Device chance="15" deviceID="&itTitanFusionDrive;"/>
						<Device chance="10" deviceID="&itNM900MissilePod;"/>
					</Table>
				</Group>
			</Table>
		</Devices>

		<Items>
			<Item count="2d6" item="&itHeliumAssembly;"/>
		</Items>

		<Image imageID="&rsMediumShips2;" imageX="320" imageY="0" imageWidth="64" imageHeight="64"/>

		<AISettings
			fireRateAdj=		"15"
			fireAccuracy=		"85"
			perception=			"4"
			/>

		<Maneuver
			rotationCount=		"20"
			maxRotationRate=	"9.0"
			rotationAccel=		"1.0"
			/>
		<Effects>
			<Effect type="thrustMain"		posAngle="141"	posRadius="27"	posZ="0"	rotation="180"/>
			<Effect type="thrustMain"		posAngle="-141"	posRadius="27"	posZ="0"	rotation="180"/>
			<Effect type="rotateRight"		posAngle="82"	posRadius="23"	posZ="0"	rotation="0"/>
			<Effect type="rotateRight"		posAngle="-98"	posRadius="23"	posZ="0"	rotation="180"/>
			<Effect type="rotateLeft"		posAngle="-82"	posRadius="23"	posZ="0"	rotation="0"/>
			<Effect type="rotateLeft"		posAngle="98"	posRadius="23"	posZ="0"	rotation="180"/>
		</Effects>

	</ShipClass>
	
	<!-- Aurochs Transport -->

	<ShipClass UNID="&scAurochs;"
			manufacturer=		""
			class=				"Aurochs"
			type=				"transport"
			score=				"1090"

			mass=				"8000"
			cargoSpace=			"5600"
			thrust=				"3000"
			maneuver=			"9"
			maxSpeed=			"15"

			explosionType=		"&vtBlastExplosion4;"
			leavesWreck=		"80"

			attributes=			"commonwealth, commonwealthFleet, genericClass"
			>

			<Armor
			armorID=			"&itP120HexphaseArmor;"
			count=				"12"
			/>
			
			<Interior>
                        <Compartment name="interior"
                                        hitPoints=        "80"
                                        />
						<Compartment name="main drive"
                                        type=                "mainDrive"
                                        hitPoints=        "50"

                                        posX=                "-22"
                                        posY=                "0"
                                        sizeX=                "52"
                                        sizeY=                "10"
                                        />
		</Interior>

		<Devices>
			<Device deviceID="&itTeV9Blaster;" omnidirectional="true"/>
			<Device deviceID="&itR5Deflector;"/>
		</Devices>

		<Image imageID="&rsMediumShips3;" imageX="768" imageY="0" imageWidth="96" imageHeight="96" imageFrameCount="0" imageTicksPerFrame="0"/>
		
		<Maneuver
			rotationCount=		"20"
			maxRotationRate=	"4.0"
			rotationAccel=		"0.5"
			/>
			
			<Effects>
					<Effect type="thrustMain"		posAngle="157"	posRadius="43"	posZ="0"	rotation="180"	effect="&efMainThrusterLarge;"/>
					<Effect type="thrustMain"		posAngle="180"	posRadius="42"	posZ="10"	rotation="180"	effect="&efMainThrusterLarge;"/>
					<Effect type="thrustMain"		posAngle="-157"	posRadius="43"	posZ="0"	rotation="180"	effect="&efMainThrusterLarge;"/>
			</Effects>

		<Items>
			<Item count="1d12" item="&itXenotiteFuelRod;"/>
		</Items>

		<Names noArticle="true">
			Aurochs Alpha-%0%0; Aurochs Beta-%0%0; Aurochs Gamma-%0%0;
			Aurochs Delta-%0%0; Aurochs Epsilon-%0%0; Aurochs Zeta-%0%0;
			Aurochs Eta-%0%0; Aurochs Theta-%0%0; Aurochs Iota-%0%0;
			Aurochs Kappa-%0%0; Aurochs Lambda-%0%0; Aurochs Mu-%0%0;
			Aurochs Nu-%0%0; Aurochs Xi-%0%0; Aurochs Omicron-%0%0;
			Aurochs Pi-%0%0; Aurochs Rho-%0%0; Aurochs Sigma-%0%0;
			Aurochs Tau-%0%0; Aurochs Upsilon-%0%0; Aurochs Phi-%0%0;
			Aurochs Chi-%0%0; Aurochs Psi-%0%0; Aurochs Omega-%0%0
		</Names>

		<AISettings
			fireRateAdj=		"20"
			fireAccuracy=		"90"
			perception=			"4"
			combatStyle=		"standOff"
			/>

	</ShipClass>
	
	<ShipClass UNID="&scAquilaCruiser;"
			manufacturer=		"Pacific Defense Corporation"
			class=				"Aquila"
			type=				"cruiser"
			
			score=				"3210"
			mass=				"10000"
			cargoSpace=			"1000"
			thrustRatio=		"0.5"
			maxSpeed=			"16"

			cyberDefenseLevel=	"8"
			explosionType=		"&vtThermoExplosion2;"
			leavesWreck=		"100"

			attributes=			"capitalShip, commonwealth, commonwealthFleet, commonwealthMilitary, genericClass"
			>

		<Armor
			armorID=			"&itP210HexphaseArmor;"
			count=				"16"
			/>

		<Devices>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="355" maxFireArc="175" posAngle="99" posRadius="22"/>
			<Device deviceID="&itStarCannon;" secondaryWeapon="true" minFireArc="160" maxFireArc="5" posAngle="261" posRadius="22"/>
			<Device deviceID="&itTeV9PD;"/>
			<Device deviceID="&itNAMIHeavyLauncher;" omnidirectional="true"/>
			<Device deviceID="&vtDamageControlParty;"/>
			<Device deviceID="&itR9Deflector;"/>
		</Devices>
		
		 <Interior>
                        <Compartment name="interior"
                                        hitPoints=        "200"
                                        />
                        
                        <Compartment name="main drive"
                                        type=                "mainDrive"
                                        hitPoints=        "100"

                                        posX=                "-75"
                                        posY=                "0"
                                        sizeX=                "42"
                                        sizeY=                "56"
                                        />
                </Interior>

		<Image imageID="&rsLargeShips1;" imageX="1728" imageY="0" imageWidth="192" imageHeight="192" imageFrameCount="0" imageTicksPerFrame="0"/>

		<Maneuver
			rotationCount=		"20"
			maxRotationRate=	"3"
			rotationAccel=		"0.5"
			/>
			
		<Effects>
			<Effect type="thrustMain"		posAngle="168"	posRadius="82"	posZ="-20"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="-168"	posRadius="82"	posZ="-20"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="180"	posRadius="82"	posZ="-5"	rotation="180"	effect="&efMainThrusterLarge;"/>
		</Effects>
		
		<Items>
			<Item count="5d20" item="&itM2Missile;"/>
		</Items>

		<AISettings
			fireRateAdj=		"20"
			fireAccuracy=		"95"
			perception=			"5"
			combatStyle=		"standOff"
			/>

	</ShipClass>
	
	<!-- CSC Base Class
	
	EXTRA DATA
	
	behavior:			Ship's current behavior
							Nil					= holding position and available for missions
							'defendingCritical	= CSC is being attack by powerful enemy
							'moving				= CSC is moving to a new position
							
	disableDefense:		If TRUE, then we don't deploy defenders (we use this when we want to
						let the player handle it).

	squadron:			Entries for each ship in the CSC's squadron.
							Each entry in the squadron is a list:
								0: objID
								1: ship class
								2: status:
									'home
									'deployed
									'destroyed
	
	targetObj:			Target to destroy. If the CSC is in 'defendingCritical mode, then this
						is the capital ship that is attacking it.
						
	-->

	<ShipClass UNID="&baCSCBase;"
			class=				"(CSC base class)"
			virtual=			"true"
			
			attributes=			"baseClass"
			>

		<Events>
			<OnAttackedByPlayer>
				(block Nil
					(if (not (eq (shpGetOrder gSource) 'attackHold))
						(shpOrderImmediate gSource 'attackHold gPlayerShip 10)
						)
					)
			</OnAttackedByPlayer>

			<OnBehavior>
				(block (behavior attackerList)
					(setq behavior (objGetData gSource "behavior"))
					
					(switch
						(eq behavior 'defendingCritical)
							Nil
							
						(eq behavior 'moving)
							Nil

						(block (attackerList highValueEnemies)
							(switch
								; If we don't have anyone attacking us, then there is
								; nothing to do.
								(not (setq attackerList (sysFindObject gSource "sAEPX")))
									Nil
									
								; If we're not supposed to attack, then don't
								(objGetData gSource "disableDefense")
									Nil
									
								; If any of the attackers are level 10 or higher, then we need serious
								; help. (e.g Phobos) Deploy all Britannia IIs (2 on each CSC) and some Britannias
								(setq highValueEnemies (filter attackerList theObj (geq (objGetLevel theObj) 10)))
									(block (theTarget)
										(setq theTarget (random highValueEnemies))
										(objSetObjRefData gSource "targetObj" theTarget)
										(objRegisterForEvents gSource theTarget)
										(for i 1 2
											(block (theShip)
												(setq theShip (sysCreateShip &scBritannia2; (objGetPos gSource) (objGetSovereign gSource)))
													(shpOrder theShip 'attack theTarget)
													(shpOrder theShip 'attackNearestEnemy)
													(shpOrder theShip 'gate gSource)
												)
											)
										(for i 1 6
											(block (brit)
											;Changed this from the CSC squadron so that the CSC can deploy 6 more Britannias if another level 9 enemy shows up
												(setq brit (sysCreateShip &scBritannia; (objGetPos gSource) (objGetSovereign gSource)))
												(if brit
													(block Nil
														(shpOrder brit 'attack theTarget)
														(shpOrder brit 'attackNearestEnemy)
														(shpOrder brit 'gate gSource)
														)
													)
												)
											)

										(objSetData gSource "behavior" 'defendingCritical)
										)
								; If any of the attackers are level 9, then we need
								; help. Deploy some Britannias.
								(setq highValueEnemies (filter attackerList theObj (eq (objGetLevel theObj) 9)))
									(block (theTarget )
										(setq theTarget (random highValueEnemies))
										(objSetObjRefData gSource "targetObj" theTarget)
										(objRegisterForEvents gSource theTarget)

										(for i 1 6
											(block (theShip)
											;Changed this from the CSC squadron so that the CSC can deploy 6 more Britannias if another level 9 enemy shows up
												(setq theShip (sysCreateShip &scBritannia; (objGetPos gSource) (objGetSovereign gSource)))
												(if theShip
													(block Nil
														(shpOrder theShip 'attack theTarget)
														(shpOrder theShip 'attackNearestEnemy)
														(shpOrder theShip 'gate gSource)
														)
													)
												)
											)

										(objSetData gSource "behavior" 'defendingCritical)
										)
								)
							)
						)
					)
			</OnBehavior>
			
			<Radar>
			(block (target wing)
								(setq target (sysFindObject gSource "sE N:100 ;"))
								(if target
								;; found a target, attack it	
								
								(for i 1 6
								(block (ship)
									(setq ship (sysCreateShip &scCenturion; (objGetPos gSource) (objGetSovereign gSource)))
									;(plyMessage gPlayer "Fighters Deployed!")
									;;Send fighters
									(shpOrder ship 'attack target)
									(shpOrder ship 'attackNearestEnemy)
									(shpOrder ship 'gate gSource)
									(objIncData gSource "flight")
									;(setq wing (objGetData gSource "flight"))
									;(plyMessage gplayer "flight is "wing"?")
								)
							)
							
						)
					)
			</Radar>
			
			<ReinforcementCheck>
			(block Nil
			
			(if (not (ls (objGetData gSource "flight") 17))
			(block (target)
								(setq target (sysFindObject gSource "sE N:150 ;"))
								(for i 1 6
								(block (ship)
									(setq ship (sysCreateShip &scBritannia; (objGetPos gSource) (objGetSovereign gSource)))
									;(plyMessage gPlayer "Deployed!")
									;;Send fighters
									(shpOrder ship 'attack target)
									(shpOrder ship 'attackNearestEnemy)
									(shpOrder ship 'gate gSource)
								)
							)
							;Sets flight to 0 so that we don't keep spawning Britannias
							(objSetData gSource "flight" 0)
							;(setq wing (objGetData gSource "flight"))
							;(plyMessage gplayer "flight is "wing"!!!")
						)
					)
					(if (geq (objGetData gSource "flight") 1)
					(objSetData gSource "flight" (subtract (objGetData gSource "flight") 1))
					;(setq wing (objGetData gSource "flight"))
					;(plyMessage gplayer "flight is "wing"...")
					)
				)
			</ReinforcementCheck>
			
			<OnCreate>
				(block (squadronList)
					; Are we in a good spot? If not, then we give orders to move
					(fltOrderCheckPosition gSource)

					; Create the Britannia squadron
					(for i 1 6
						(cscSquadronCreateShip gSource &scBritannia2;)
						)

					; Behavior event
					(sysAddObjRecurringTimerEvent 90 gSource "OnBehavior")
					(sysAddObjRecurringTimerEvent 900 gSource "Radar")
					(sysAddObjRecurringTimerEvent 3600 gSource "ReinforcementCheck")
					
					;Initialize data
					(objSetData gSource "flight" 0)
					
					(switch
							
								(eq (objGetData gSource "CSC") "america")
								(block Nil
									(objAddItem gSource (itmCreate &itOmniThermoCannon; 1))
									(shpInstallDevice gSource (itmCreate &itOmniThermoCannon; 1))
									(objAddItem gSource (itmCreate &itThermoCannonShell; 500))
									)
							
								(eq (objGetData gSource "CSC") "india")
								(block Nil
									(objAddItem gSource (itmCreate &itLightningTurret; 1))
									(shpInstallDevice gSource (itmCreate &itLightningTurret; 1))
									)
							
								(eq (objGetData gSource "CSC") "atlantica")
								(block Nil
									(objAddItem gSource (itmCreate &itOmniIonBlaster; 1))
									(shpInstallDevice gSource (itmCreate &itOmniIonBlaster; 1))
									)
								(eq (objGetData gSource "CSC") "asia")
								(block Nil
									(objAddItem gSource (itmCreate &itNAMIMissileLauncher; 1))
									(shpInstallDevice gSource (itmCreate &itNAMIMissileLauncher; 1))
									(objAddItem gSource (itmCreate &itXM900Missile; 250))
									)
								(eq (objGetData gSource "CSC") "pacifica")
								(block Nil
									(objAddItem gSource (itmCreate &itTM7Cannon; 1))
									(shpInstallDevice gSource (itmCreate &itTM7Cannon; 1))
									(objAddItem gSource (itmCreate &itTM7Warhead; 500))
									)
								(eq (objGetData gSource "CSC") "sahara")
								(block Nil
									(objAddItem gSource (itmCreate &itTeV9PD; 1))
									(shpInstallDevice gSource (itmCreate &itTeV9PD; 1))
									)
								(eq (objGetData gSource "CSC") "arctica")
								(block Nil
									(objAddItem gSource (itmCreate &vtDamageControlParty; 1))
									(shpInstallDevice gSource (itmCreate &vtDamageControlParty; 1))
									)
								(eq (objGetData gSource "CSC") "antartica")
								(block Nil
									(objAddItem gSource (itmCreate &vtDamageControlParty; 1))
									(objAddItem gSource (itmCreate &itTeV9PD; 1))
									(shpInstallDevice gSource (itmCreate &vtDamageControlParty; 1))
									(shpInstallDevice gSource (itmCreate &vtDamageControlParty; 1))
									(shpInstallDevice gSource (itmCreate &itTeV9PD; 1))
									)
								(eq (objGetData gSource "CSC") "terra")
								(block Nil
									(objAddItem gSource (itmCreate &vtDamageControlParty; 1))
									(objAddItem gSource (itmCreate &itTeV9PD; 1))
									(shpInstallDevice gSource (itmCreate &vtDamageControlParty; 1))
									(shpInstallDevice gSource (itmCreate &vtDamageControlParty; 1))
									(shpInstallDevice gSource (itmCreate &itTeV9PD; 1))
									)
							)
					)
			</OnCreate>

			<OnDestroy>
				(block (squadronList)
					; Destroy our squadron
					(setq squadronList (objGetData gSource "squadron"))
					(objSetData gSource "squadron" Nil)
					(enum squadronList theEntry
						(if (eq (item theEntry 2) 'home)
							(objDestroy (objGetObjByID (item theEntry 0)))
							)
						)
					
					; Commonwealth is mad too
					(intCommonwealthOnDestroy)

					; Military will execute the player
					(if (and gPlayerShip (eq aOrderGiver gPlayerShip))
						(intFleetCrime 3 (cat "the destruction of " (objGetName gSource 4)))
						)
					)
			</OnDestroy>

			<OnObjDestroyed>
				(block (behavior theID theEntry squadronList)
					(setq behavior (objGetData gSource "behavior"))
					
					(switch
						; See if we destroyed the target
						(and (eq behavior 'defendingCritical)
								(eq aObjDestroyed (objGetObjRefData gSource "targetObj"))
								)
							(block Nil
								(objSetData gSource "behavior" Nil)
								)
						
						; If the ship entered a stargate, then ignore it
						(eq aDestroyReason 'enteredStargate)
							Nil
						
						; See if this is one of our gunships	
						(setq theEntry (match (setq squadronList (objGetData gSource "squadron")) theEntry 
								(eq (item theEntry 0) (setq theID (objGetID aObjDestroyed)))
								))
							(block Nil
							
								; Mark the entry as destroyed
								(setq squadronList (map squadronList theEntry
									(if (eq (item theEntry 0) theID)
										(list theID (item theEntry 1) 'destroyed)
										theEntry
										)
									))
									
								(objSetData gSource "squadron" squadronList)
								
								;(dbgOutput theID ": Destroyed")
								)
						)
					)
			</OnObjDestroyed>

			<OnObjEnteredGate>
				(block (theID theEntry squadronList)
					(setq theID (objGetID aObj))
					
					(switch
						(not (setq theEntry (match (setq squadronList (objGetData gSource "squadron")) theEntry (eq (item theEntry 0) theID))))
							Nil
							
						(block Nil
							; Repair and reload the ship
							(intArmorRepairAll aObj 10)
							(shpRechargeShield aObj 1000)
							(objFireEvent aObj "Reload")
							
							; Suspend object
							(objSuspend aObj)
							
							; Mark the entry as home
							(setq squadronList (map squadronList theEntry
								(if (eq (item theEntry 0) theID)
									(list theID (item theEntry 1) 'home)
									theEntry
									)
								))
								
							(objSetData gSource "squadron" squadronList)

							;(dbgOutput theID ": Returned to carrier")
							)
						)
					)
			</OnObjEnteredGate>
			
			<OnOrdersCompleted>
				(block (behavior)
					(setq behavior (objGetData gSource "behavior"))
					(switch
						(eq behavior 'moving)
							(block Nil
								(shpOrder gSource 'hold)
								(objSetData gSource "behavior" Nil)
								)

						(block Nil
							(shpOrder gSource 'hold)
							(objSetData gSource "behavior" Nil)
							)
						)
					)
			</OnOrdersCompleted>
		</Events>
	</ShipClass>
	
	<!-- CSC Task Force
	
	GLOBAL DATA
	
	missionsAccepted:	Total missions accepted
	missionsCompleted:	Total missions completed successfully
	missionsFailed:		Total missions failed

	EXTRA DATA
	
	MissionID:			ID of current mission
	MissionStatus:		Current status of mission:
							Nil					= no mission in progress
							'inprogress			= mission in progress
							'success			= mission succeeded
							'failure			= mission failed

	PLAYER SHIP EXTRA
	
	fleetTFSuccess:		Total number of successful missions
	fleetTFFailure:		Total number of failed missions

	-->

	<ShipClass UNID="&scCSCTaskForce;"
			manufacturer=                "Earth Industries"
			class=				"Commonwealth Star Carrier"
			type=				""
			score=				"2330"

			mass=				"50000"
			cargoSpace=			"5000"
			thrustRatio=                "0.5"
			maxSpeed=			"2"

			cyberDefenseLevel=	"8"
			explosionType=		"&vtThermoExplosion4;"
			leavesWreck=		"100"

			attributes=			"capitalShip, commonwealth, commonwealthFleet, commonwealthMilitary, genericClass, fleetLaw, majorShip"

			dockScreen=			"Main"
			defaultBackgroundID="&rsCSCBkgnd;"
			
			inherit=			"&baCSCBase;"
			>

		<Armor
			armorID=			"&itP1000HexphaseArmor;"
			count=				"20"
			/>

		<Devices>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" minFireArc="270" maxFireArc="90"  posAngle="0" posRadius="64"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" minFireArc="90"  maxFireArc="270" posAngle="180" posRadius="64"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" omnidirectional="true" posAngle="90" posRadius="44"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" omnidirectional="true" posAngle="270" posRadius="44"/>
			<Device deviceID="&itNAMIHeavyLauncher;" omnidirectional="true"/>
			
			<Device deviceID="&itTeV9PD;"  posAngle="0" posRadius="30"/>
			<Device deviceID="&itTeV9PD;" posAngle="180" posRadius="30"/>
			<Device deviceID="&itParticleEnhancer;"/>
			<Device deviceID="&vtDamageControlParty;"/>
			<Device deviceID="&vtDamageControlParty;"/>
		</Devices>
		
		 <Interior>
                        <Compartment name="interior"
                                        hitPoints=        "600"
                                        />
                        
                        <Compartment name="main drive"
                                        type=                "mainDrive"
                                        hitPoints=        "200"

                                        posX=                "-56"
                                        posY=                "0"
                                        sizeX=                "42"
                                        sizeY=                "60"
                                        />
                </Interior>

		<Items>
			<Item				count="500"	item="&itM2Missile;"/>
			<Item				count="6d12"	item="&itPteracniumFuelRod;"/>
		</Items>

		<Image imageID="&rsLargeShips2;" imageX="0" imageY="0" imageWidth="256" imageHeight="256" />
		
		<Maneuver
			rotationCount=		"20"
			maxRotationRate=	"1"
			rotationAccel=		"0.1"
			/>
			
		<Effects>
			<Effect type="thrustMain"		posAngle="170"	posRadius="75"	posZ="-5"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="180"	posRadius="74"	posZ="-5"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="-170"	posRadius="75"	posZ="-5"	rotation="180"	effect="&efMainThrusterLarge;"/>
		</Effects>

		<AISettings
			fireRateAdj=		"10"
			fireAccuracy=		"95"
			perception=			"6"
			noFriendlyFire=		"true"
			/>

		<StaticData>
			<!--

			MISSIONS
			
			Each Fleet rank has a set of missions. Successfully completing a mission
			awards the player Fleet XP according to the rank. (Note that these are 
			target values; some missions give variable awards.)
			
			1.	Civilian			 100 xp (50% of next rank)
			2.	Privateer			 150 xp (38% of next rank)
			3.	Master Sargeant		 250 xp (28% of next rank)
			4.	Fleet Lieutenant	 500 xp (33% of next rank)
			5.	Fleet Commander		1750 xp	(25% of next rank)
			
			DATA FORMAT
			
			The first code block must return a string describing the
			mission (or Nil, if a mission could not be found).

			The code should also place any data about the mission in global variable
			that can be accessed by the second code block.

			The second code block initiates the mission from global variables
			set by the first code block. It should permanently store the mission
			as object data.

			The third code block returns a string describing the success of
			the mission (or Nil, if the mission is in progress)
			
			-->

			<!-- Level 1 Missions (Civilian) -->

			<Missions1>
				(
					; Recon mission
					;
					; OBJECTIVE: Player must recon a major Ares station in the system
					; REQUIREMENTS: Major Ares station must exist in the system.
					; COMBAT: None
					
					("mission1a"
						; Code to describe mission
						(lambda Nil
							(block (stationList)
								; Look for a major Ares station in the system
								(setq stationList (sysFindObject gSource "AT +ares; +majorStation"))

								; If we found at least one, then pick a random one
								(setq gTarget (random stationList))

								(switch
									; If we have no target, then no mission
									(not gTarget)
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
											Nil
											)

									; Otherwise, OK
									(cat "\"We need you to do a recon mission on " (objGetName gTarget 4) " in this system. All you have to do is fly past it and make visual contact. We'll enter the coordinates to your computer. What do you say?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (timer)
								; Remember what we're supposed to recon
								(objSetObjRefData gSource "Target" gTarget)

								; Set the recon target in the player ship's computer
								(shpOrderEscort gPlayerShip gTarget)
								(objSetIdentified gTarget)

								; Prepare the station to be reconned
								(staClearReconned gTarget)
								(staSetFireReconEvent gTarget)

								; Get events for the station
								(objRegisterForEvents gSource gTarget)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code on successful mission
						(lambda Nil
							(block (damage)
								(setq damage (objGetVisibleDamage gPlayerShip))

								; Set description
								(switch
									(gr damage 75)
										(scrSetDesc gScreen "\"Outstanding mission! You better report to Docking Services to have all that damage repaired!\"")

									(gr damage 25)
										(scrSetDesc gScreen "\"Outstanding mission! Looks like you got a little banged up out there.\"")

									(scrSetDesc gScreen "\"Outstanding mission! You made it look easy.\"")
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 100)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Fleet Delivery mission
					;
					; OBJECTIVE: Player must deliver supplies to station in system.
					; REQUIREMENTS: A major Commonwealth station must exist in the system.
					; COMBAT: None
					
					("mission1b"
						; Code to describe mission
						(lambda Nil
							(block Nil
								; Look for a major commonwealth station in the system that is at least
								; 300 light-seconds from here.
								(setq stationList (sysFindObject gSource "T:fleetDelivery; A R:300;"))

								; If we found at least one, then pick a random one
								(setq gTarget (random stationList))

								(switch
									; If we have no target, then no mission
									(or (not gTarget) (objGetData gTarget "fleetMissionCargo"))
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions currently available.\"")
											Nil
											)

									; Otherwise, OK
									(cat "\"We need you to take much needed supplies to " (objGetName gTarget 4) " in this system. We'll empty your cargo hold so that we can fit as much cargo as possible (but don't worry, you'll get all your stuff back). We'll program the delivery coordinates into your flight computer. What do you say?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (allItems count neededItem roll enemyAmbush)
								; Remember the mission (so that we will know when we reach
								; our destination)
								(objSetObjRefData gPlayerShip "fleetMission" gSource)

								; Remember where we're supposed to deliver this stuff
								(objSetObjRefData gSource "Target" gTarget)

								; Set the target in the player ship's computer
								(shpOrderEscort gPlayerShip gTarget)
								(objSetIdentified gTarget)

								; Remove all uninstalled items from the player's ship (except missiles/ammo or IDs)
								(objSetData gSource "fleetMissionSavedCargo" (setq allItems (objGetItems gPlayerShip "*U~m -ID;")))
								(enum allItems thisItem
									(objRemoveItem gPlayerShip thisItem)
									)

								; Pick a random item
								(setq neededItem (random '(&itGradeAGrains; &itWaterIce; &itMedicalSupplies; &itSalmonite;)))

								; Figure out how many barrels of grain we can take (must be at least 1)
								(setq count (max 1 (objGetFitCount gPlayerShip (itmCreate neededItem 100000))))

								; Add the items to the player ship (and remember)
								(objAddItem gPlayerShip (itmCreate neededItem count))
								(objSetData gTarget "fleetMissionCargo" (objGetItems gPlayerShip "*U~m -ID;"))

								; Figure out what kind of enemy will attack the player
								(setq roll (random 1 100))
								(switch
									(leq roll 60)
										(setq enemyAmbush &etKobolAmbush1;)

									(leq roll 90)
										(setq enemyAmbush &etRogueAmbush1;)

									(setq enemyAmbush &etAresAmbush2;)
									)

								; On timer, enemies attack player
								(sysAddEncounterEventAtDist 
									(add 300 (random 0 150)) 
									gPlayerShip 
									enemyAmbush 
									(random 120 200)
									)
								)
							)

						; Code on successful mission
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Nice work! Those supplies will do some good.\"")

								; Restore the items that we took from the player
								(enum (objGetData gSource "fleetMissionSavedCargo") thisItem
									(objAddItem gPlayerShip thisItem)
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 100)
								)
							)

						; Code on failure
						(lambda Nil
							(block (target)
								; Remove the supplies (if the player has any)
								(setq target (objGetObjRefData gSource "Target"))
								(setq items (objGetData target "fleetMissionCargo"))

								(enum items thisItem
									(objRemoveItem gPlayerShip thisItem)
									)
									
								; Restore the items that we took from the player
								(enum (objGetData gSource "fleetMissionSavedCargo") thisItem
									(objAddItem gPlayerShip thisItem)
									)

								(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
								)
							)
						)

					; Juan Carlos mission
					;
					; OBJECTIVE: Player must retrieve a data ROM from Juan Carlos
					; REQUIREMENTS: None
					; UNIQUE: Yes
					
					("mission1c"
						; Code to describe mission
						(lambda Nil
							(switch
								; If we've already done this mission, then don't bother
								(typGetGlobalData &scEI500JuanCarlos; "deliverROM")
									(block Nil
										(setq gMissionNoneText "\"Sorry, there are no missions currently available.\"")
										Nil
										)

								; Otherwise, OK
								(cat "\"We need you to rendezvous and dock with a freighter a few light-minutes away. Pick up a data ROM and bring it back here safely. Understood?\"")
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (ship)
								; Create the Juan Carlos some place relatively safe
								(setq ship 
									(sysCreateShip 
										&scEI500JuanCarlos; 
										(sysVectorRandom gSource (random 240 400) 60 "Ts")
										&svCommonwealth;
										)
									)
								(shpOrderHold ship)

								; Set the player to go there
								(shpOrderDock gPlayerShip ship)
								(objSetIdentified ship)
								(objSetObjRefData gPlayerShip "MissionSource" gSource)

								; Track the player
								(objRegisterForEvents gSource gPlayerShip)

								; Sometimes the freighter is under attack
								(if (leq (random 1 100) 50)
									(sysAddEncounterEventAtDist 0 ship &etAresAmbush1; (objGetDistance gSource ship))
									)

								; Can't get this mission again
								(typSetGlobalData &scEI500JuanCarlos; "deliverROM" True)
								)
							)

						; Code on successful mission
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Nice work! The data on this ROM is very important for the admiral and the Fleet.\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 100)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Intercept Ares patrol
					;
					; OBJECTIVE: Player must intercept Ares patrol heading for CSC.
					; REQUIREMENTS: None.
					
					("mission1d"
						; Code to describe mission
						(lambda Nil
							"\"There's an Ares patrol inbound that wants to take a peek at us. Your mission is to intercept and destroy the entire flight before it can gate out of the system and report our location. Understood?\""
							)

						; Code to initiate mission
						(lambda Nil
							(block (squadronCount startPos)
								; Remember how many we need to kill
								(setq squadronCount 8)
								(objSetData gSource "TargetCount" squadronCount)
								(objSetData gSource "TargetsLeft" squadronCount)

								(setq startPos (sysVectorRandom gSource (random 100 120) 60))

								; Create the squadron a certain distance away and send them 
								; to the carrier.
								(for i 0 (subtract squadronCount 1)
									(block (ship)
										(setq ship
											(sysCreateShip 
												&scSandstorm; 
												(sysVectorPolarOffset startPos (random 0 359) (random 1 6))
												&svAres;
												)
											)

										; Order the ship to patrol near the CSC
										(shpOrderPatrol ship gSource 3)

										; Remember the ship
										(objSetObjRefData gSource (cat "Target" i) ship)
										(objRegisterForEvents gSource ship)
										)
									)

								; Set the target
								(shpCancelOrders gPlayerShip)
								(shpOrderAttack gPlayerShip (objGetObjRefData gSource "Target0"))
								(objSetIdentified (objGetObjRefData gSource "Target0"))

								; We create a timer to check on the position of the ships
								(sysAddObjRecurringTimerEvent 30 gSource "OnAresPatrolCheck")
								)
							)

						; Code on successful mission
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Outstanding, pilot! That's the way to do it!\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 100)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)
					)
			</Missions1>

			<!-- Level 2 Missions (Privateer) -->
			
			<Missions2>
				(
					; Destroy Ares freighter
					;
					; OBJECTIVES: Intercept and destroy an enemy freighter.
					; REQUIREMENTS: Ares station must exist more than 300 light-seconds from any one stargate.
					
					("mission2a"
						; Code to describe mission
						(lambda Nil
							(block (gate stationList)
								; Get the list of all Ares bases
								(setq stationList (sysFindObject gSource "T:ares;A"))
								(setq gEnd Nil)

								; For each stargate, see if we can travel to an Ares base
								; stop looking when we find a destination
								(enumwhile
									(sysFindObject gSource "G -uncharted;")
									(not gEnd)
									gate

									(block (bestDist testDest)
										; Pick a stargate
										(setq gStart gate)

										; Find the nearest base to the stargate that is at least
										; 300 light-seconds away from the stargate
										(setq bestDist 1200)
										(enum stationList testDest
											(if (and 
													(gr (objGetDistance gStart testDest) 300)
													(ls (objGetDistance gStart testDest) bestDist))
												(block Nil
													(setq bestDist (objGetDistance gStart testDest))
													(setq gEnd testDest)
													)
												)
											)
										)
									)

								; If we found a station, then compose the mission text
								(if gEnd
									(cat "\"An Ares freighter is delivering supplies to " (objGetName gEnd 4) " in this system. Your orders are to intercept and destroy the freighter. Any questions?\"")
									Nil
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (ship ETA)

								; Remember the start point and the end station
								(objSetObjRefData gSource "StartGate" gStart)
								(objSetObjRefData gSource "EndObj" gEnd)
								(objSetObjRefData gSource "Target" Nil)

								; Create a timer for the creation of the freighter
								(setq ETA 
									(subtract 
										(sysCalcTravelTime (objGetDistance gStart gSource) (shpGetMaxSpeed gPlayerShip))
										(sysCalcTravelTime 100 (typGetDataField &scPolar; "maxSpeed"))
										)
									)
								(sysAddObjTimerEvent ETA gSource "OnTimerFreighterAppears2A")

								; point the player to the stargate
								(shpCancelOrders gPlayerShip)
								(shpOrderDock gPlayerShip gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Outstanding mission! That's one less supply ship for the Martians&#x97;just a matter of time before this war is over.\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 150)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Defend superfreighter
					;
					; OBJECTIVES: Player must escort a superfreighter
					; REQUIREMENTS: At least one stargate must be more than 300 light-seconds away.
					
					("mission2b"
						; Code to describe mission
						(lambda Nil
							(block (gateList)
								; Find a stargate more than 300 light-seconds away
								(setq gateList (sysFindObject gSource "GR:300; -uncharted;"))

								; See if we meet all requirements
								(switch
									; If there are no gates near by, there is no mission
									(not gateList)
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions currently available.\"")
											Nil
											)

									; Otherwise, we compose the mission text
									(block Nil
										(setq gStart (random gateList))
										(cat "\"A superfreighter carrying pteracnium ore will enter the system at " (objGetName gStart 0) " and rendezvous with us here. Your mission is to escort it safely from the gate to our location. Clear?\"")
										)
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (obstacle roll)
								; Choose a random obstacle for the mission
								(setq roll (random 1 100))
								(switch
									(leq roll 60)
										(setq obstacle 'aresAttack)

									(leq roll 90)
										(setq obstacle 'rogueAmbush)

									(setq obstacle 'suicideRun)
									)

								(objSetData gSource "MissionVariant" obstacle)

								; Remember the start point
								(objSetObjRefData gSource "StartGate" gStart)

								; Create a timer for the creation of the freighter
								(sysAddObjTimerEvent (multiply (objGetDistance gPlayerShip gStart) 3) gSource "OnTimerFreighterAppears2B")

								; point the player to the stargate
								(shpCancelOrders gPlayerShip)
								(shpOrderDock gPlayerShip gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Set description
								(if (eq (objGetData gSource "MissionVariant") 'suicideRun)
									(scrSetDesc gScreen "\"Excellent mission! Your quick reaction probably saved hundreds of lives on this ship!\"")
									(scrSetDesc gScreen "\"Excellent mission! That pteracnium fuel is desperately needed!\"")
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 150)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)
					)
			</Missions2>

			<!-- Level 3 Missions (Master Sargeant) -->
			
			<MissionRescueScientists>
				(
					; Rescue scientists
					;
					; OBJECTIVES: Rescue scientists who defected.
					; REQUIREMENTS: None.
					; UNIQUE: Yes
					
					("mission3rescue"
						; Code to describe mission
						(lambda Nil
							(cat "\"OK, this is a high-profile rescue mission, so I don't want any screw-ups!\n\n"
								"\"Two of our weapons designers have been kidnapped by rogue fleet elements. "
								"We're sending an Aurochs transport with an extraction team to rescue our Einsteins. "
								"All you've got to do is protect the transport to the rogue base and back. Clear?\""
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (base ship)
								; Create the rogue base. The base position must be at least 120 light-seconds
								; away from anything else.

								(setq base (sysCreateStation &stRogueBaseRescue; (sysVectorRandom gSource (random 400 600) 120 "t")))
								(objSetObjRefData gSource "Target" base)

								; Create the rescue ship

								(setq ship (sysCreateShip &scAurochs; gSource &svCommonwealthFleet;))
								(shpOrderDock ship base)
								(shpOrderWait ship (random 10 20))
								(shpOrderDock ship gSource)
								(shpOrderWait ship 5)
								(shpOrderGate ship)

								(objSetObjRefData gSource "Ship" ship)
								(objRegisterForEvents gSource ship)

								; orders
								(shpOrderEscort gPlayerShip ship)
								(objSetIdentified ship)
								(objRegisterForEvents gSource gPlayerShip)

								; Encounter
								(if (leq (random 1 100) 60)
									(sysAddEncounterEventAtDist (add 500 (random 0 100)) ship &etRogueAmbush1; (random 120 200))
									)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Outstanding mission! Now we can put those Einsteins back to work!\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 350)

								(typSetGlobalData &scCSCTerra; "p262scientists" "rescued")
								)
							)

						; Code on failure
						(lambda Nil
							(block Nil
								(scrSetDesc gScreen "\"That's what I get for counting on you!\n\n\"You're demoted back to Privateer! Now get out of my sight!\"")
								(objSetData gPlayerShip "fleetXP" 400)
								(objSetData gPlayerShip "fleetLevel" 2)

								(typSetGlobalData &scCSCTerra; "p262scientists" "failed")
								)
							)
						)
					)
			</MissionRescueScientists>

			<Missions3>
				(
					; Defend supply ship
					;
					; OBJECTIVES: Escort supply ship back to CSC.
					; REQUIREMENTS: At least one stargate must be more than 400 light-seconds away.
					
					("mission3a"
						; Code to describe mission
						(lambda Nil
							(block Nil
								; Find a random stargate more than 400 light-seconds from us
								(setq gStart (random (sysFindObject gSource "G R:400; -uncharted;")))

								; Describe the mission
								(if gStart
									(cat "\"A supply ship is arriving at the " (objGetName gStart) ". Your orders are to escort it back to " (objGetName gSource 4) " and defend it against all enemies. Carry On!\"")
									Nil
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block Nil
								; Set a timer to give the player a chance to get to the stargate
								(objSetObjRefData gSource "Target" gStart)
								(setq timer (add (multiply 5 (objGetDistance gSource gStart)) (random 0 200)))
								(sysAddObjTimerEvent timer gSource "OnTimerConvoyAppears3A")

								; Add some enemy ships patrolling around the stargate
								(for i 1 (random 4 6)
									(block (patrol)
										(setq patrol (sysCreateShip &scSandstorm; gStart &svAres;))
										(shpOrderPatrol patrol gStart 20)
										)
									)

								; orders
								(shpOrderEscort gPlayerShip gStart)
								(objSetIdentified gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Set description
								(scrSetDesc gScreen "\"Outstanding mission! Those supplies are desperately needed here.\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 250)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Defend Refugee Convoy
					;
					; OBJECTIVES: Defend a convoy of transports
					; REQUIREMENTS: Two gates must be at least 150 light-seconds apart
					
					("mission3b"
						; Code to describe mission
						(lambda Nil
							(block (gateList)
								; We are heading towards St Kats
								(setq gEnd (intGetGateToSystem gSource "SK"))
								
								; Get the other stargate (the farthest stargate
								; from the end).
								(setq gStart (sysFindObject gEnd "GR -uncharted;"))
								
								; Describe mission
								(switch
								
									; Make sure we have two stargates and they are at least 150
									; light-seconds from each other.
									(and gStart gEnd (geq (objGetDistance gStart gEnd) 150))
										(cat "\"A refugee convoy is passing through the system. Your mission is to lead a small squadron and escort the convoy safely through the system. Any questions?\"")
										
									; Otherwise, no mission
									(block Nil
										(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
										Nil
										)
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block Nil
								; Create some ships off-screen and bring them in
								(intFleetCreateWingmen gSource 6 &scCenturion;)

								; Set a timer to give the player a chance to get to the stargate
								(setq timer (add (multiply 5 (objGetDistance gSource gStart)) (random 0 200)))
								(sysAddObjTimerEvent timer gSource "OnTimerConvoyAppears3B")

								(objSetObjRefData gSource "StartGate" gStart)
								(objSetObjRefData gSource "EndGate" gEnd)

								; orders
								(shpOrderEscort gPlayerShip gStart)
								(objSetIdentified gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block Nil
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))

								; Set description
								(scrSetDesc gScreen "\"Outstanding mission! Those refugees have a chance to start a new life away from the war zone.\"")

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 250)
								)
							)

						; Code on failure
						(lambda Nil
							(block Nil
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))

								(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
								)
							)
						)
						
					; Intercept Ares attack
					;
					; OBJECTIVE: Player must intercept an Ares fleet heading for the CSC.
					; REQUIREMENTS: None.
					
					("mission3c"
						; Code to describe mission
						(lambda Nil
							"\"There's an Ares squadron heading our way. Your mission is to intercept and destroy it. Understood?\""
							)

						; Code to initiate mission
						(lambda Nil
							(block (roll enemyFleet startPos)
							
								; Randomly generate the enemy fleet
								
								(setq roll (random 1 100))
								(switch
									(leq roll 25)
										; 16 Sandstorms
										(setq enemyFleet '(&scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm;))
										
									(leq roll 50)
										; A Deimos plus 8 Sandstorms
										(setq enemyFleet '(&scDeimos; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm; &scSandstorm;))
									
									(leq roll 75)
										; 3 Cometfalls
										(setq enemyFleet '(&scCometfall; &scCometfall; &scCometfall;))
									
									(leq roll 100)
										; 8 Chasms
										(setq enemyFleet '(&scChasm; &scChasm; &scChasm; &scChasm; &scChasm; &scChasm; &scChasm; &scChasm;))
									)
									
								; Create the enemy squadron
								
								(setq startPos (sysVectorRandom gSource (random 250 400) 60))
								(setq i 0)
								(enum enemyFleet theEnemyClass
									(block (theShip)
										(setq theShip
											(sysCreateShip 
												theEnemyClass 
												(sysVectorPolarOffset startPos (random 0 359) (random 1 6))
												&svAres;
												)
											)
											
										; Order to attack CSC
										(shpOrder theShip 'attack gSource)
										
										; Remember the ship
										(objSetObjRefData gSource (cat "Target" i) theShip)
										(objRegisterForEvents gSource theShip)
										
										(setq i (add i 1))
										)
									)

								(objSetData gSource "Targets" enemyFleet)
								(objSetData gSource "TargetsLeft" (count enemyFleet))
								(objSetData gSource "TargetsKilledByPlayer" 0)
								
								; Set the target
								
								(shpCancelOrders gPlayerShip)
								(shpOrderAttack gPlayerShip (objGetObjRefData gSource "Target0"))
								
								; We let the player handle this (we don't scramble our own defenses)
								(objSetData gSource "disableDefense" True)
								)
							)

						; Code on successful mission
						(lambda Nil
							(block (killedByPlayer)
							
								; Compute the percent of targets killed by the player
								(setq killedByPlayer (divide (multiply 100 (objGetData gSource "TargetsKilledByPlayer")) (count (objGetData gSource "Targets"))))
								
								(switch
									(leq killedByPlayer 10)
										(scrSetDesc gScreen "\"What were you doing out there? Dancing? Next time try to hit the targets with your guns; that's what they're there for!\"")
									
									(leq killedByPlayer 25)
										(block Nil
											(scrSetDesc gScreen "\"Those ships gave you a tough time. You're going to need to up your dogfighting skills!\"")
											(objIncData gPlayerShip "fleetXP" 50)
											)
											
									(leq killedByPlayer 50)
										(block Nil
											(scrSetDesc gScreen "\"That was a hard battle, but you managed to kill quite a few targets. Well done.\"")
											(objIncData gPlayerShip "fleetXP" 100)
											)
										
									(leq killedByPlayer 80)
										(block Nil
											(scrSetDesc gScreen "\"Outstanding, pilot! That's the way to do it!\"")
											(objIncData gPlayerShip "fleetXP" 200)
											)
											
									(block Nil
										(scrSetDesc gScreen "\"I haven't seen flying like that in years! You've made this ship proud!\"")
										(objIncData gPlayerShip "fleetXP" 300)
										)
									)
									
								; Re-enable defense
								(objSetData gSource "disableDefense" Nil)
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)
					)
			</Missions3>

			<!-- Level 4 Missions (Fleet Lieutenant) -->
			
			<Missions4>
				(
					; Destroy Ares station
					;
					; OBJECTIVES: Player must destroy a major Ares station.
					; REQUIREMENTS: None.
					
					("mission4a"
						; Code to describe mission
						(lambda Nil
							(block Nil
								; Pick a random Ares station in the system
								(setq gTarget (random (sysFindObject gSource "AT +ares; +majorStation")))
								
								; If no such station exists, then create one deep in the outer system.
								; NOTE: It is OK that this has side effects as long as the station that
								; we create is a major Ares station (so subsequent calls will find it).
								
								(if (not gTarget)
									(block (stationPos stationType)
										; Pick a random station type
										(setq stationType &stAresCommune;)
										
										; Pick a random point for the station to be
										(setq stationPos (sysVectorRandom Nil (random 960 1500) 150))
										
										; Create the station
										(setq gTarget (sysCreateStation stationType stationPos))
										)
									)
								
								; Compose description
								(if gTarget
									(cat "\"This mission is straight from Admiral Decker himself. We want you to lead a flight of Britannias to destroy " (objGetName gTarget 4) " in this system. Any questions?\"")
									Nil
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block Nil
								; Create some ships off-screen a bring them in
								(intFleetCreateWingmen gSource 6 &scBritannia;)

								; Point-out the station to destroy
								(objSetObjRefData gSource "Target" gTarget)
								(objRegisterForEvents gSource gTarget)
								(shpOrderAttack gPlayerShip gTarget)
								(objSetIdentified gTarget)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block (shipsLeft)
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))

								; Set description
								(switch
									(eq shipsLeft 0)
										(scrSetDesc gScreen (cat "\"A tough mission. We can't afford to lose so many good pilots.\""))

									(eq shipsLeft 1)
										(scrSetDesc gScreen (cat "\"Good mission! It's unfortunate that only one of your wingmen survived.\""))

									(scrSetDesc gScreen (cat "\"Outstanding mission! Looks like you came back with " shipsLeft " wingmen.\""))
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" (add 250 (multiply shipsLeft 100)))
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)

					; Destroy Ares convoy
					;
					; OBJECTIVES: Player must destroy an Ares convoy.
					; REQUIREMENTS: Two stargates must be at least 200 light-seconds away from each other
					
					("mission4b"
						; Code to describe mission
						(lambda Nil
							(block (gateList)
								(setq gStart Nil)

								; Get the list of gates in the system
								(setq gateList (sysFindObject gSource "G -uncharted;"))

								; Make sure there are at least 2 gates
								(if (geq (count gateList) 2)
									(block Nil
										(setq gStart (item gateList 0))
										(setq gEnd (item gateList 1))

										; The two gates better be at least 200 light-seconds
										; away from each other
										(if (ls (objGetDistance gStart gEnd) 200)
											(setq gStart Nil)
											)
										)
									)

								; Set text
								(switch
									; If we have no target, then no mission
									(not gStart)
										(block Nil
											(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
											Nil
											)

									; Otherwise, OK
									(cat "\"A large Ares convoy will enter the system at " (objGetName gStart 0) ". Take a flight of Centurions and destroy as many freighters as you can before they leave the system. Any questions?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (variant)
								; Create some ships off-screen a bring them in
								(intFleetCreateWingmen gSource 6 &scCenturion;)

								; Choose mission variant
								(setq roll (random 1 100))
								(switch
									(leq roll 60)
										(setq variant 'chasmEscort)

									(leq roll 90)
										(setq variant 'advancedPolar)

									(setq variant 'deimosEscort)
									)

								(objSetData gSource "MissionVariant" variant)

								; Remember the start and end point
								(objSetObjRefData gSource "StartGate" gStart)
								(objSetObjRefData gSource "EndGate" gEnd)

								; Init counters
								(objSetData gSource "FreightersEscaped" 0)
								(objSetData gSource "TargetsDestroyed" 0)
								(objSetData gSource "WingmenDestroyed" 0)

								; Create a timer for the creation of the freighter
								(sysAddObjTimerEvent (multiply (objGetDistance gPlayerShip gStart) 1) gSource "OnTimerConvoyAppears4B")

								; point the player to the stargate
								(shpCancelOrders gPlayerShip)
								(shpOrderDock gPlayerShip gStart)
								(objRegisterForEvents gSource gPlayerShip)
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block (shipsLeft shipsLeftText)
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))
								(setq shipsLeftText (item (list 'zero 'one 'two 'three 'four 'five 'six) shipsLeft))

								; Set description
								(switch
									(leq shipsLeft 2)
										(scrSetDesc gScreen (cat "\"A tough mission. We can't afford to lose so many good pilots.\""))

									(leq shipsLeft 4)
										(scrSetDesc gScreen (cat "\"Good mission! It's unfortunate that only " shipsLeftText " of your wingmen survived.\""))

									(scrSetDesc gScreen (cat "\"Outstanding mission! Looks like you came back with " shipsLeftText " wingmen.\""))
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" (multiply (objGetData gSource "TargetsDestroyed") 100))
								(objIncData gPlayerShip "fleetXP" (multiply shipsLeft 50))
								)
							)

						; Code on failure
						(lambda Nil
							(block Nil
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))

								(switch
									(eq (objGetData gSource "WingmenDestroyed") 6)
										(scrSetDesc gScreen "\"What kind of a leader loses all %his% wingmen and dares to return alive! Next time do us all a favor and kill yourself!\"")

									(gr (objGetData gSource "WingmenDestroyed") (objGetData gSource "TargetsDestroyed"))
										(scrSetDesc gScreen "\"You lost more wingmen against those freighters than most people do against an Ares dreadnought! Your leadership skills are pathetic. Get out of my sight!\"")

									(eq (objGetData gSource "TargetsDestroyed") 0)
										(scrSetDesc gScreen "\"You didn't even destroy a single freighter! That wing of Centurions is wasted on you!\"")

									(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
									)
								)
							)
						)
					)
			</Missions4>

			<!-- Level 5 Missions (Fleet Commander) -->
			
			<Missions5>
				(
					; Destroy Target
					;
					; OBJECTIVES: Destroy a target.
					; REQUIREMENTS: None.
					
					("mission5a"
						; Code to describe mission
						(lambda Nil
							(block Nil
								(switch
									; Otherwise, OK
									(cat "\"Your orders are to lead a flight of Britannias and intercept and destroy an unknown hostile. We'll enter the coordinates to your computer. What do you say?\"")
									)
								)
							)

						; Code to initiate mission
						(lambda Nil
							(block (targetPos roll)
								; Create some ships off-screen a bring them in
								(intFleetCreateWingmen gSource 6 &scBritannia;)

								; Pick a random location for the target
								(setq targetPos (sysVectorRandom gSource (random 300 600) 250))

								; Create targets
								(setq roll (random 1 100))
								(switch
									; Target is Phobos dreadnought
									(leq roll 60)
										(block (theShip)
											(setq theShip (sysCreateShip &scPhobos; targetPos &svAres;))
											(shpOrder theShip 'waitForTarget gPlayerShip)
											(shpOrder theShip 'attack gPlayerShip)
											(shpOrder theShip 'attack gSource)

											(objSetObjRefData gSource "Target1" theShip)
											(objRegisterForEvents gSource theShip)

											(objSetData gSource "TargetCount" 1)
											)

									; Target is wing of Sandstorms
									(leq roll 90)
										(block (shipCount theLeader)
											(setq shipCount 35)
											(objSetData gSource "TargetCount" shipCount)

											(for i 1 shipCount
												(block (theShip)
													(setq theShip 
														(sysCreateShip &scSandstorm;
															(sysVectorPolarOffset
																targetPos
																(random 0 359)
																(add (random 1 12) (random 0 12))
																)
															&svAres;
															)
														)
														
													(if (not theLeader)
														(block Nil
															(shpOrder theShip 'waitForTarget gPlayerShip)
															(shpOrder theShip 'attack gPlayerShip)
															(shpOrder theShip 'attack gSource)
															(setq theLeader theShip)
															)
														(shpOrder theShip 'escort theLeader)
														)

													(objSetObjRefData gSource (cat "Target" i) theShip)
													(objRegisterForEvents gSource theShip)
													)
												)
											)

									; Target is flight of Deimos destroyers
									(block (shipCount theLeader)
										(setq shipCount 3)
										(objSetData gSource "TargetCount" shipCount)

										(for i 1 shipCount
											(block (theShip)
												(setq theShip 
													(sysCreateShip &scDeimos;
														(sysVectorPolarOffset
															targetPos
															(random 0 359)
															(add (random 1 12) (random 0 12))
															)
														&svAres;
														)
													)
													
												(if (not theLeader)
													(block Nil
														(shpOrder theShip 'waitForTarget gPlayerShip)
														(shpOrder theShip 'attack gPlayerShip)
														(shpOrder theShip 'attack gSource)
														(setq theLeader theShip)
														)
													(shpOrder theShip 'escort theLeader)
													)

												(objSetObjRefData gSource (cat "Target" i) theShip)
												(objRegisterForEvents gSource theShip)
												)
											)
										)
									)

								(objSetData gSource "TargetsDestroyed" 0)

								; Point player at target
								(shpCancelOrders gPlayerShip)
								(shpOrder gPlayerShip 'attack (objGetObjRefData gSource "Target1"))
								)
							)

						; Code to see if mission has been completed
						(lambda Nil
							(block (shipsLeft shipsLeftText)
								; Disperse wingmen
								(setq shipsLeft (intFleetDisperseWingmen gSource 6))
								(setq shipsLeftText (item (list 'zero 'one 'two 'three 'four 'five 'six) shipsLeft))

								; Set description
								(switch
									(leq shipsLeft 2)
										(scrSetDesc gScreen (cat "\"A tough mission. We can't afford to lose so many good pilots.\""))

									(leq shipsLeft 4)
										(scrSetDesc gScreen (cat "\"Good mission! It's unfortunate that only " shipsLeftText " of your wingmen survived.\""))

									(scrSetDesc gScreen (cat "\"Outstanding mission! Looks like you came back with " shipsLeftText " wingmen.\""))
									)

								; Increment XP
								(objIncData gPlayerShip "fleetXP" 1000)
								(objIncData gPlayerShip "fleetXP" (multiply shipsLeft 100))
								)
							)

						; Code on failure
						(lambda Nil
							(scrSetDesc gScreen "\"You screwed that mission all the way to Sol and back. You better hit the sims, pilot!\"")
							)
						)
					)
			</Missions5>
		</StaticData>

		<Events>
			<OnDestroy>
				(block Nil
					; If we're in the middle of the delivery mission, then put the player's
					; stuff on the ship

					(if (and (eq (objGetData gSource "MissionStatus") "inprogress")
							(eq (objGetData gSource "MissionID") "mission1b")
							)
						(enum (objGetData gSource "fleetMissionSavedCargo") thisItem
							(objAddItem gSource thisItem)
							)
						)
						
					; Base class
					
					(typFireObjEvent &baCSCBase; gSource 'OnDestroy)
					)
			</OnDestroy>

			<OnObjDestroyed>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							; If the player was destroyed, stop the mission
							(eq aObjDestroyed gPlayerShip)
								(block Nil
									(objSetData gSource "MissionStatus" "failure")
									(typIncGlobalData &scCSCTaskForce; "missionsFailed")
									(shpCancelOrders gPlayerShip)

									; Disperse wingmen
									(intFleetDisperseWingmen gSource 10)
									
									; Re-enable defense, if necessary
									(objSetData gSource "disableDefense" Nil)
									)
									
							(and (eq missionID "mission1a") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(objUnregisterForEvents gSource aObjDestroyed)
									(shpCancelOrders gPlayerShip)
									)
									
							(eq missionID "mission1d")
								(block (targetSet)
									(for i 0 (subtract (objGetData gSource "TargetCount") 1)
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Target" i)))
											(objIncData gSource "TargetsLeft" -1)
											(if (and (not targetSet) (objGetObjRefData gSource (cat "Target" i)))
												(block Nil
													(shpCancelOrders gPlayerShip)
													(shpOrderAttack gPlayerShip (objGetObjRefData gSource (cat "Target" i)))
													(objSetIdentified (objGetObjRefData gSource (cat "Target" i)))
													(setq targetSet True)
													)
												)
											)
										)

									(if (eq (objGetData gSource "TargetsLeft") 0)
										(block Nil
											(plyMessage gPlayer "Mission complete!")
											(objSetData gSource "MissionStatus" "success")
											(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
											(sysCancelTimerEvent gSource "OnAresPatrolCheck")
											)
										(if (eq (objGetData gSource "TargetsLeft") 1)
											(plyMessage gPlayer "1 target left!")
											(plyMessage gPlayer (objGetData gSource "TargetsLeft") " targets left")
											)
										)
									)

							(and (eq missionID "mission2a") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(shpCancelOrders gPlayerShip)
									)

							(and (eq missionID "mission2b") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(if (and 
										(eq (objGetData gSource "MissionVariant") 'suicideRun)
										(objGetData aObjDestroyed "Armed")
										)
									(block Nil
										(sysCreateWeaponFire &itM5Missile; Nil (objGetPos aObjDestroyed) 0 0 gSource True)
										(plyMessage gPlayer "Mission complete!")
										(objSetData gSource "MissionStatus" "success")
										(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
										(shpCancelOrders gPlayerShip)
										)
									(block Nil
										(plyMessage gPlayer "Mission failed")
										(objSetData gSource "MissionStatus" "failure")
										(typIncGlobalData &scCSCTaskForce; "missionsFailed")
										(shpCancelOrders gPlayerShip)
										)
									)

							(and (eq missionID "mission3rescue") (eq aObjDestroyed (objGetObjRefData gSource "Ship")))
								(block Nil
									(plyMessage gPlayer "Mission failed")
									(objSetData gSource "MissionStatus" "failure")
									(typIncGlobalData &scCSCTaskForce; "missionsFailed")
									(shpCancelOrders gPlayerShip)
									)

							(and (eq missionID "mission3a") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission failed")
									(objSetData gSource "MissionStatus" "failure")
									(typIncGlobalData &scCSCTaskForce; "missionsFailed")
									(shpCancelOrders gPlayerShip)
									)

							(eq missionID "mission3b")
								(block (shipClass)
									(setq shipClass (objGetType aObjDestroyed))
									(switch
										(eq shipClass &scScarabFreighter;)
											(objIncData gSource "SuperfreightersDestroyed")

										(eq shipClass &scEI100;)
											(objIncData gSource "FreightersDestroyed")
										)

									; Tell the player

									(plyMessage gPlayer (objGetName aObjDestroyed 1) " destroyed")

									; If more than 1 superfreighter has been destroyed or if
									; more than 4 freighters have been destroyed, then the player cannot win

									(if (or (gr (objGetData gSource "SuperfreightersDestroyed") 1)
											(gr (objGetData gSource "FreightersDestroyed") 4)
											)
										(block Nil
											(plyMessage gPlayer "Mission failed")
											(objSetData gSource "MissionStatus" "failure")
											(typIncGlobalData &scCSCTaskForce; "missionsFailed")
											(shpCancelOrders gPlayerShip)
											)
										)
									)

							(eq missionID "mission3c")
								(block (targetSet)
									(for i 0 (subtract (count (objGetData gSource "Targets")) 1)
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Target" i)))
											(block Nil
												(objIncData gSource "TargetsLeft" -1)
												(if (eq aOrderGiver gPlayerShip)
													(objIncData gSource "TargetsKilledByPlayer" 1)
													)
												)
											(if (and (not targetSet) (objGetObjRefData gSource (cat "Target" i)))
												(block Nil
													(shpCancelOrders gPlayerShip)
													(shpOrderAttack gPlayerShip (objGetObjRefData gSource (cat "Target" i)))
													(objSetIdentified (objGetObjRefData gSource (cat "Target" i)))
													(setq targetSet True)
													)
												)
											)
										)

									(if (eq (objGetData gSource "TargetsLeft") 0)
										(block Nil
											(plyMessage gPlayer "Mission complete!")
											(objSetData gSource "MissionStatus" "success")
											(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
											)
										(if (eq (objGetData gSource "TargetsLeft") 1)
											(plyMessage gPlayer "1 target left!")
											(plyMessage gPlayer (objGetData gSource "TargetsLeft") " targets left")
											)
										)
									)

							(and (eq missionID "mission4a") (eq aObjDestroyed (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(shpCancelOrders gPlayerShip)
									)

							(eq missionID "mission4b")
								(block Nil
									(for i 0 4
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Target" i)))
											(block (escaped destroyed lost)
												(setq escaped (objGetData gSource "FreightersEscaped"))
												(setq destroyed (add (objGetData gSource "TargetsDestroyed") 1))
												(objSetData gSource "TargetsDestroyed" destroyed)
												(setq lost (objGetData gSource "WingmenDestroyed"))

												(if (eq (add escaped destroyed) 5)
													(block Nil
														(if	(or (eq destroyed 0) (gr lost destroyed))
															(block Nil
																(plyMessage gPlayer "Mission failed")
																(objSetData gSource "MissionStatus" "failure")
																(typIncGlobalData &scCSCTaskForce; "missionsFailed")
																)
															(block Nil
																(plyMessage gPlayer "Mission complete!")
																(objSetData gSource "MissionStatus" "success")
																(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
																)
															)

														(objUnregisterForEvents gSource gPlayerShip)
														(shpCancelOrders gPlayerShip)
														)
													)
												)
											)
										)

									(for i 0 5
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Wingman" i)))
											(objIncData gSource "WingmenDestroyed")
											)
										)
									)

							(eq missionID "mission5a")
								(block Nil
									(for i 1 (objGetData gSource "TargetCount")
										(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Target" i)))
											(block Nil
												(objIncData gSource "TargetsDestroyed")
												(objSetObjRefData gSource (cat "Target" i) Nil)

												; If we destroyed all targets, then we're done. Otherwise
												; we point the player at a new target

												(if (eq (objGetData gSource "TargetCount") (objGetData gSource "TargetsDestroyed"))
													(block Nil
														(plyMessage gPlayer "Mission complete!")
														(objSetData gSource "MissionStatus" "success")
														(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
														)
													(block (foundTarget)
														(for i 1 (objGetData gSource "TargetCount")
															(block (theTarget)
																(setq theTarget (objGetObjRefData gSource (cat "Target" i)))
																(if (and theTarget (not foundTarget))
																	(block Nil
																		(shpCancelOrders gPlayerShip)
																		(shpOrder gPlayerShip 'attack theTarget)
																		(setq foundTarget True)
																		)
																	)
																)
															)
														)
													)
												)
											)
										)
									)
							)
							
						; Call to base
						(typFireObjEvent &baCSCBase; gSource 'OnObjDestroyed)
						)

					; Even if mission is no longer in progress we track wingmen
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							(eq missionID "mission4b")
								(for i 0 5
									(if (eq aObjDestroyed (objGetObjRefData gSource (cat "Wingman" i)))
										(objIncData gSource "WingmenDestroyed")
										)
									)
							)
							
						; Call to base
						(typFireObjEvent &baCSCBase; gSource 'OnObjDestroyed)
						)
					)
			</OnObjDestroyed>

			<OnObjDocked>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							(and (eq missionID "mission1c") (eq aObjDocked gPlayerShip) (eq aDockTarget gSource))
								(if (objGetItems gPlayerShip "* +LamplighterDataROM;")
									(block Nil
										(objRemoveItem gPlayerShip (itmCreate &itLamplighterDataROM; 1))
										(objSetData gSource "MissionStatus" "success")
										(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
										(shpCancelOrders gPlayerShip)
										)
									)

							(and (eq missionID "mission2a") (eq aObjDocked (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission failed")
									(objSetData gSource "MissionStatus" "failure")
									(typIncGlobalData &scCSCTaskForce; "missionsFailed")
									(objUnregisterForEvents gSource aObjDocked)
									(shpCancelOrders gPlayerShip)
									)

							(and (eq missionID "mission2b") (eq aObjDocked (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(objUnregisterForEvents gSource aObjDocked)
									(shpCancelOrders gPlayerShip)
									)

							(and (eq missionID "mission3rescue") (eq aObjDocked (objGetObjRefData gSource "Ship")))
								(switch
									; Docked with base
									(eq aDockTarget (objGetObjRefData gSource "Target"))
										(block Nil
											(plyMessage gPlayer "Extraction commencing")

											; Add some encounters
											(sysAddEncounterEventAtDist (add 500 (random 0 100)) aObjDocked &etRogueAmbush2; (random 120 200))
											(sysAddEncounterEventAtDist (add 1000 (random 0 100)) aObjDocked &etRogueAmbush1; (random 120 200))
											)

									; Docked back with the carrier
									(eq aDockTarget gSource)
										(block Nil
											(plyMessage gPlayer "Mission complete!")
											(objSetData gSource "MissionStatus" "success")
											(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
											(objUnregisterForEvents gSource aObjDocked)
											(shpCancelOrders gPlayerShip)
											)
									)

							(and (eq missionID "mission3a") (eq aObjDocked (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Mission complete!")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(objUnregisterForEvents gSource aObjDocked)
									(shpCancelOrders gPlayerShip)
									)
							)
						)
					)
			</OnObjDocked>

			<OnObjEnteredGate>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							(eq missionID "mission1d")
								(block Nil
									(for i 0 (subtract (objGetData gSource "TargetCount") 1)
										(if (eq aObj (objGetObjRefData gSource (cat "Target" i)))
											(block Nil
												(plyMessage gPlayer "Mission failed")
												(objSetData gSource "MissionStatus" "failure")
												(typIncGlobalData &scCSCTaskForce; "missionsFailed")
												(sysCancelTimerEvent gSource "OnAresPatrolCheck")
												)
											)
										)
									)

							(eq missionID "mission3b")
								(block (shipClass)
									(setq shipClass (objGetType aObj))
									(switch
										(eq shipClass &scScarabFreighter;)
											(objIncData gSource "SuperfreightersEscaped")

										(eq shipClass &scEI100;)
											(objIncData gSource "FreightersEscaped")
											
										(setq shipClass Nil)
										)
										
									; If it's not one of the ships that we were expecting, then
									; don't do anything.
									
									(if shipClass
										(block Nil

											; Unregister so that we don't get called again at OnObjDestroyed
											(if (not (eq aObj gPlayerShip))
												(objUnregisterForEvents gSource aObj)
												)

											; If all ships are accounted for, then the mission is
											; successful.

											(if (eq (add (objGetData gSource "SuperfreightersDestroyed") 
														(objGetData gSource "FreightersDestroyed")
														(objGetData gSource "SuperfreightersEscaped")
														(objGetData gSource "FreightersEscaped"))
													11)
												(block Nil
													(plyMessage gPlayer "Mission complete!")
													(objSetData gSource "MissionStatus" "success")
													(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
													(objUnregisterForEvents gSource gPlayerShip)
													(shpCancelOrders gPlayerShip)
													)
												)
											)
										)
									)

							(eq missionID "mission4b")
								(for i 0 4
									(if (eq aObj (objGetObjRefData gSource (cat "Target" i)))
										(block (escaped destroyed lost)
											(setq escaped (add (objGetData gSource "FreightersEscaped") 1))
											(objSetData gSource "FreightersEscaped" escaped)
											(setq destroyed (objGetData gSource "TargetsDestroyed"))
											(setq lost (objGetData gSource "WingmenDestroyed"))

											(objSetObjRefData gSource (cat "Target" i) Nil)
											(objUnregisterForEvents gSource aObj)

											(if (eq (add escaped destroyed) 5)
												(block Nil
													(if	(or (eq destroyed 0) (gr lost destroyed))
														(block Nil
															(plyMessage gPlayer "Mission failed")
															(objSetData gSource "MissionStatus" "failure")
															(typIncGlobalData &scCSCTaskForce; "missionsFailed")
															)
														(block Nil
															(plyMessage gPlayer "Mission complete!")
															(objSetData gSource "MissionStatus" "success")
															(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
															)
														)

													(objUnregisterForEvents gSource gPlayerShip)
													(shpCancelOrders gPlayerShip)
													)
												)
											)
										)
									)
							)

						; Call to base
						(typFireObjEvent &baCSCBase; gSource 'OnObjEnteredGate)
						)
						
					; Else
					(typFireObjEvent &baCSCBase; gSource 'OnObjEnteredGate)
					)
			</OnObjEnteredGate>

			<OnObjReconned>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (missionID)
						(setq missionID (objGetData gSource "MissionID"))
						(switch
							(and (eq missionID "mission1a") (eq aObj (objGetObjRefData gSource "Target")))
								(block Nil
									(plyMessage gPlayer "Recon completed")
									(objSetData gSource "MissionStatus" "success")
									(typIncGlobalData &scCSCTaskForce; "missionsCompleted")
									(objUnregisterForEvents gSource aObj)
									(shpCancelOrders gPlayerShip)
									)
							)
						)
					)
			</OnObjReconned>
			
			<OnAresPatrolCheck>
				(block (inScanRange)
					; Are Ares ships in scan range?
					(for i 0 (subtract (objGetData gSource "TargetCount") 1)
						(if (objGetObjRefData gSource (cat "Target" i))
							(if (leq (objGetDistance (objGetObjRefData gSource (cat "Target" i)) gSource) 12)
								(setq inScanRange True)
								)
							)
						)

					; Recall the ships
					(if inScanRange
						(block Nil
							(for i 0 (subtract (objGetData gSource "TargetCount") 1)
								(block (ship)
									(setq ship (objGetObjRefData gSource (cat "Target" i)))
									(if ship
										(block Nil
											(shpCancelOrders ship)
											(shpOrderGate ship)
											)
										)
									)
								)

							(sysCancelTimerEvent gSource "OnAresPatrolCheck")
							)
						)
					)
			</OnAresPatrolCheck>

			<OnSuicideRunCheck2B>
				(block (freighter dist)
					(setq freighter (objGetObjRefData gSource "Target"))
					(if freighter
						(setq dist (objGetDistance gSource freighter))
						)

					(switch
						(not freighter)
							(block Nil
								(sysCancelTimerEvent gSource "OnSuicideRunCheck2B")
								)

						(ls dist 3)
							(block (pos)
								(sysCancelTimerEvent gSource "OnSuicideRunCheck2B")

								; Mission failed
								(plyMessage gPlayer "Mission failed")
								(objSetData gSource "MissionStatus" "failure")
								(typIncGlobalData &scCSCTaskForce; "missionsFailed")
								(shpCancelOrders gPlayerShip)

								(setq pos (objGetPos freighter))
								(objDestroy freighter)
								(sysCreateWeaponFire &itM5Missile; Nil pos 0 0 gSource True)
								)

						(and (ls dist 15) (objGetData freighter "Armed"))
							(if (leq (random 1 100) 25)
								(objSendMessage 
									gPlayerShip
									gSource
									(random
										(list
											"Destroy the freighter!"
											"Blast the bloody freighter!"
											"Do you copy? Destroy the freighter now!"
											(plyComposeString gPlayer "%name%, destroy the freighter!")
											"The freighter is on a suicide run! Destroy it!"
											)
										)
									)
								)

						(and (ls dist 25) (not (objGetData freighter "Armed")))
							(block Nil
								; Freighter is on sucide run
								(objSetSovereign freighter &svRogueFleet;)
								(shpCancelOrders freighter)
								(shpOrderGoto freighter gSource)
								(shpOrderHold freighter)
								(objSetData freighter "Armed" True)

								; Set the CSC to wait (so that it doesn't blast the freighter on its own)
								; we assume that the CSC is caught by surprise
								(shpCancelOrders gSource)
								(shpOrderWait gSource 15)
								(shpOrderHold gSource)

								; Player should destroy freighter
								(objSendMessage gPlayerShip gSource "Freighter on suicide run!")
								(objSendMessage gPlayerShip gSource "Destroy the freighter!")
								(shpCancelOrders gPlayerShip)
								(shpOrderAttack gPlayerShip freighter)
								(objSetIdentified freighter)
								)
						)
					)
			</OnSuicideRunCheck2B>

			<OnTimerConvoyAppears3A>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (ship)
						(plyMessage gPlayer "Transport has arrived")

						; create the transport that will go back to the carrier
						(setq ship (sysCreateShip &scAurochs; (objGetObjRefData gSource "Target") &svCommonwealthFleet;))
						(shpOrderDock ship gSource)
						(shpOrderGate ship)

						; Remember this ship
						(objSetObjRefData gSource "Target" ship)

						; Add an encounter half-way
						(if (leq (random 1 100) 90)
							(sysAddEncounterEventAtDist 
								(random 500 1000)
								(if (eq (random 1 3) 1) gPlayerShip ship)
								(random
									(list
										&etAresAmbush1;
										&etAresAmbush2;
										&etAresAmbush2;
										&etRogueAmbush1;
										&etRogueAmbush1;
										&etRogueAmbush2;
										)
									)
								(random 120 200)
								)
							)

						; register so we know when the transport is destroyed
						(objRegisterForEvents gSource ship)

						; Point the player to the transport
						(shpCancelOrders gPlayerShip)
						(shpOrderEscort gPlayerShip ship)
						(objSetIdentified ship)
						)
					)
			</OnTimerConvoyAppears3A>

			<OnTimerConvoyAppears3B>
				(if (eq (objGetData gSource "MissionStatus") "inprogress")
					(block (freightersLeft dist totalTime timePortion)
						(plyMessage gPlayer "Convoy has arrived")

						; A superfreighter takes 8 ticks to move 1 light-second.

						(setq dist (objGetDistance (objGetObjRefData gSource "StartGate") (objGetObjRefData gSource "EndGate")))
						(setq totalTime (multiply dist 8))
						(setq timePortion (divide totalTime 12))

						; Create all the ships

						(setq freightersLeft 8)
						(for i 0 2
							(block (ship)
								(setq ship (sysCreateShip &scScarabFreighter; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
								(shpOrderGate ship (objGetObjRefData gSource "EndGate"))
								(objSetData ship "noPiracyCheck" True)
								(objRegisterForEvents gSource ship)

								(if (eq i 0)
									(block Nil
										(shpOrderEscort gPlayerShip ship)
										(objSetIdentified ship)
										)
									)

								(for j 0 2
									(if (gr freightersLeft 0)
										(block Nil
											(setq escort (sysCreateShip &scEI100; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
											(objSetData escort "noPiracyCheck" True)
											(shpOrderFollow escort ship)
											(objRegisterForEvents gSource escort)

											(setq freightersLeft (subtract freightersLeft 1))
											)
										)
									)

								; On timer, enemies attack ship
								(sysAddEncounterEventAtDist 
									(multiply timePortion (add (multiply i 4) (random 1 3)))
									(if (eq (random 1 3) 1) gPlayerShip ship)
									&etAresAmbush1; 
									(random 120 200)
									)
								)
							)

						; Keep track of how many ship were destroyed and how many escaped
						(objSetData gSource "SuperfreightersEscaped" 0)
						(objSetData gSource "FreightersEscaped" 0)
						(objSetData gSource "SuperfreightersDestroyed" 0)
						(objSetData gSource "FreightersDestroyed" 0)
						)
					)
			</OnTimerConvoyAppears3B>

			<OnTimerConvoyAppears4B>
				(block (variant startGate endGate)
					(setq variant (objGetData gSource "MissionVariant"))
					(setq startGate (objGetObjRefData gSource "StartGate"))
					(setq endGate (objGetObjRefData gSource "EndGate"))

					(switch
						(eq variant 'chasmEscort)
							(block Nil
								(for i 0 4
									(block (freighter escort)
										(setq freighter (sysCreateShip &scPolar; startGate &svAres;))
										(shpOrderGate freighter endGate)
										(objSetObjRefData gSource (cat "Target" i) freighter)
										(objRegisterForEvents gSource freighter)

										(setq escort (sysCreateShip &scChasm; startGate &svAres;))
										(shpOrderEscort escort freighter)
										)
									)
								)

						(eq variant 'advancedPolar)
							(block Nil
								(for i 0 4
									(block (freighter escort)
										(setq freighter (sysCreateShip &scPolar2; startGate &svAres;))
										(shpOrderGate freighter endGate)
										(objSetObjRefData gSource (cat "Target" i) freighter)
										(objRegisterForEvents gSource freighter)

										(setq escort (sysCreateShip &scSandstorm; startGate &svAres;))
										(shpOrderEscort escort freighter)

										(setq escort (sysCreateShip &scSandstorm; startGate &svAres;))
										(shpOrderEscort escort freighter)
										)
									)
								)

						(eq variant 'deimosEscort)
							(block Nil
								(for i 0 4
									(block (freighter escort)
										(setq freighter (sysCreateShip &scPolar; startGate &svAres;))
										(shpOrderGate freighter endGate)
										(objSetObjRefData gSource (cat "Target" i) freighter)
										(objRegisterForEvents gSource freighter)

										(if (or (eq i 0) (eq i 2))
											(block Nil
												(setq escort (sysCreateShip &scDeimos; startGate &svAres;))
												(shpOrderEscort escort freighter)
												)
											)
										)
									)
								)
						)

					; Point the player at the lead freighter
					(shpCancelOrders gPlayerShip)
					(shpOrderAttack gPlayerShip (objGetObjRefData gSource "Target0"))
					(objSetIdentified (objGetObjRefData gSource "Target0"))
					)
			</OnTimerConvoyAppears4B>

			<OnTimerFreighterAppears2A>
				(block (ship startGate targetStation)
					(setq startGate (objGetObjRefData gSource "StartGate"))
					(setq targetStation (objGetObjRefData gSource "EndObj"))

					; create the transport
					(setq ship (sysCreateShip &scPolar; startGate &svAres;))
					(shpOrderDock ship targetStation)
					(shpOrderGate ship)

					; create the escorts
					(for i 1 5
						(block (escort)
							(setq escort (sysCreateShip &scSandstorm; startGate &svAres;))
							(shpOrderEscort escort ship)
							)
						)

					; Add some items to the transport
					(objAddItem ship (itmCreate &itPteracniumOre; (random 10 30)))
					(objAddRandomItems ship &trConsumables6; (random 1 4))
					(objAddRandomItems ship &trMinorItem6; 1)

					; register so we know when the main ship is destroyed
					(objRegisterForEvents gSource ship)
					(objSetObjRefData gSource "Target" ship)

					; orders
					(shpCancelOrders gPlayerShip)
					(shpOrderAttack gPlayerShip ship)
					(objSetIdentified ship)
					)
			</OnTimerFreighterAppears2A>

			<OnTimerFreighterAppears2B>
				(block (variant)
					(setq variant (objGetData gSource "MissionVariant"))
					(switch
						(eq variant 'aresAttack)
							(block (freighter)
								; Create the superfreighter
								(setq freighter (sysCreateShip &scScarabFreighter; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
								(objSetData freighter "noPiracyCheck" True)
								(shpOrderDock freighter gSource)
								(shpOrderWait freighter (random 6 18))
								(shpOrderGate freighter)

								(plyMessage gPlayer "Freighter arriving")
								(objSetObjRefData gSource "Target" freighter)
								(objRegisterForEvents gSource freighter)

								; Create an encounter after a certain period of time
								(sysAddEncounterEventAtDist 
									(random 1000 1500) 
									freighter 
									&etAresAmbush4; 
									(random 120 200)
									)

								(if (leq (random 1 100) 90)
									(sysAddEncounterEventAtDist 
										(random 1000 1500) 
										gPlayerShip 
										&etAresAmbush2; 
										(random 120 200)
										)
									)

								(if (leq (random 1 100) 20)
									(sysAddEncounterEventAtDist 
										(random 1350 1900) 
										freighter 
										&etAresAmbush2; 
										(random 120 200)
										)
									)

								; Order escort
								(shpCancelOrders gPlayerShip)
								(shpOrderEscort gPlayerShip freighter)
								(objSetIdentified freighter)
								)

						(eq variant 'rogueAmbush)
							(block (freighter ambushPos mineLayer waitPos pathPos)
								; Create the superfreighter
								(setq freighter (sysCreateShip &scScarabFreighter; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
								(objSetData freighter "noPiracyCheck" True)
								(shpOrderDock freighter gSource)
								(shpOrderWait freighter (random 6 18))
								(shpOrderGate freighter)

								(plyMessage gPlayer "Freighter arriving")
								(objSetObjRefData gSource "Target" freighter)
								(objRegisterForEvents gSource freighter)

								; Figure out where the ambush point is
								(setq pathPos (random 35 65))
								(setq ambushPos (sysGetNavPathPoint
									&svCommonwealth;
									(objGetObjRefData gSource "StartGate")
									gSource
									pathPos
									))

								; Create a rogue transport that will lay mines in the path
								(setq mineLayer (sysCreateShip &scRogueMineLayer; ambushPos &svRogueFleet;))
								(objSetData mineLayer "MinePos" ambushPos)

								; Create a bunch of mines in addition
								(for i 0 (random 10 20)
									(sysCreateWeaponFire &itStaticMine; mineLayer (sysVectorPolarOffset ambushPos (random 0 359) (random 1 5)) 0 0 Nil)
									)

								; Figure out where the centurions will wait
								(setq waitPos (sysGetNavPathPoint
									&svCommonwealth;
									(objGetObjRefData gSource "StartGate")
									gSource
									(add pathPos 15)
									))
								(setq waitPos (sysCreateMarker "" waitPos &svRogueFleet;))

								; Create some centurions that will attack once the freighter
								; goes through the mines
								(for i 0 (random 2 4)
									(block (theShip thePos)
										(setq thePos (sysVectorPolarOffset waitPos (random 0 359) (random 10 14)))
										(setq theShip (sysCreateShip &scCenturion; thePos &svRogueFleet;))
										(shpOrderPatrol theShip waitPos 7)
										)
									)

								; Order escort
								(shpCancelOrders gPlayerShip)
								(shpOrderEscort gPlayerShip freighter)
								(objSetIdentified freighter)
								)

						(eq variant 'suicideRun)
							(block Nil
								; Create the superfreighter
								(setq freighter (sysCreateShip &scScarabFreighter; (objGetObjRefData gSource "StartGate") &svCommonwealth;))
								(objSetData freighter "noPiracyCheck" True)
								(shpOrderDock freighter gSource)

								(plyMessage gPlayer "Freighter arriving")
								(objSetObjRefData gSource "Target" freighter)
								(objRegisterForEvents gSource freighter)

								; Create a recurring timer that will turn the freighter into a suicide bomber
								(sysAddObjRecurringTimerEvent 31 gSource "OnSuicideRunCheck2B")

								; Order escort
								(shpCancelOrders gPlayerShip)
								(shpOrderEscort gPlayerShip freighter)
								(objSetIdentified freighter)
								)
						)
					)
			</OnTimerFreighterAppears2B>
		</Events>

		<DockScreens>
			<Main>
				<InitialPane>
					(block (missionID missionStatus)
						(setq missionID (objGetData gSource "MissionID"))
						(setq missionStatus (objGetData gSource "MissionStatus"))
						
						; If we're in the middle of the fleetDelivery mission and we can't
						; dock with the target, then we fail
						(if (and (eq missionID 'mission1b)
								(eq missionStatus 'inprogress)
								(objIsAngryAt (objGetObjRefData gSource "Target") gPlayerShip))
							(block Nil
								(setq missionStatus "failure")
								(objSetData gSource "MissionStatus" missionStatus)
								(typIncGlobalData &scCSCTaskForce; "missionsFailed")
								(shpCancelOrders gPlayerShip)
								)
							)
						
						(switch
							(eq missionStatus "inprogress")
								"MissionInProgress"

							(eq missionStatus "failure")
								"MissionFailure"

							(eq missionStatus "success")
								"MissionSuccess"

							"Default"
							)
						)
				</InitialPane>

				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (cat "You are in the docking bay of the " (objGetName gSource) "."))
						</OnPaneInit>

						<Actions>
							<Action name="Bridge" key="B">
								<Navigate screen="Bridge"/>
							</Action>

							<Action name="Flight Deck" key="F">
								<Navigate screen="FlightDeck"/>
							</Action>

							<Action name="Dock Services" key="D">
								(scrShowScreen gScreen "&dsFleetDockServices;")
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>

					<MissionFailure>
						<OnPaneInit>
							(block (success failure)
								; Get the mission
								(setq gMission (objGetData gSource "Mission"))

								; Execute the post-mission code (which must set the description).
								(apply (eval (item gMission 4)) Nil)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block (success failure)
									(objSetData gSource "MissionStatus" Nil)

									(setq success (objGetData gPlayerShip "fleetTFSuccess"))
									(setq failure (add (objGetData gPlayerShip "fleetTFFailure") 1))
									(objSetData gPlayerShip "fleetTFFailure" failure)

									(scrShowPane gScreen "Default")
									)
							</Action>
						</Actions>
					</MissionFailure>

					<MissionInProgress
							desc="&quot;What is your major malfunction!? Get back out there and complete your mission!&quot;">

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								<Exit/>
							</Action>
						</Actions>
					</MissionInProgress>

					<MissionSuccess>

						<OnPaneInit>
							(block (success failure)
								; Get the mission
								(setq gMission (objGetData gSource "Mission"))

								; Execute the post-mission code (which must set the description).
								(apply (eval (item gMission 3)) Nil)

								; Update mission success/failures
								(setq success (add (objGetData gPlayerShip "fleetTFSuccess") 1))
								(setq failure (objGetData gPlayerShip "fleetTFFailure"))
								(objSetData gPlayerShip "fleetTFSuccess" success)

								; Done with mission
								(objSetData gSource "MissionStatus" Nil)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Continue" default="1" cancel="1" key="C">
								(block Nil
									; Back to default (we do this so that dsFleetPromotion
									; returns to the proper place).
									(scrShowPane gScreen "Default")
									
									; If see if we got promoted
									(if (intFleetPromotion)
										(block Nil
											(setq gName Nil)
											(scrShowScreen gScreen "&dsFleetPromotion;")
											)
										)
									)
							</Action>
						</Actions>
					</MissionSuccess>

				</Panes>

			</Main>

			<Bridge
				name=			"Bridge"
				>

				<Panes>
					<Default>
						<OnPaneInit>
							(switch
								(eq (objGetData gSource "CSC") "america")
									(scrSetDesc gScreen "You talk to the captain of the CSC America. \"The Ares have been ruthless. When we lost the CSC Europa, the damn Martians deliberately targeted the emergency capsules. We taught them a lesson after that, though: we torched several of their communes.\"")

								(eq (objGetData gSource "CSC") "india")
									(scrSetDesc gScreen "You talk to the captain of the CSC India. \"If you ever get back to the Commonwealth, you've got to tell them to send more ships. We're getting killed out here and I don't even know if anyone back home cares.\"")

								(eq (objGetData gSource "CSC") "atlantica")
									(scrSetDesc gScreen "You talk to the captain of the CSC Atlantica. \"This war has been tough on the troops. We've had to start scavenging for vital supplies. I'm not surprised that the discipline in some units has deteriorated.\"")

								(eq (objGetData gSource "CSC") "asia")
									(scrSetDesc gScreen "You talk to the captain of the CSC Asia. \"When the Antarctica went rogue, Admiral Decker just about pissed acid. He was furious! He took it as a personal betrayal.\"")

								(eq (objGetData gSource "CSC") "pacifica")
									(scrSetDesc gScreen "You talk to the captain of the CSC Pacifica. \"You ever meet a Martian? Not the meek little Syrtians&#x97;I mean the Ares clones. They all have this smug look of superiority that cranks me up. They look better in the crosshairs of TeV 9, that's for sure!\"")

								(scrSetDesc gScreen "The captain welcomes you aboard.")
								)
						</OnPaneInit>

						<Actions>
							<Action name="Leave" cancel="1" key="L">
								<Navigate screen="Main"/>
							</Action>
						</Actions>
					</Default>
				</Panes>

			</Bridge>

			<FlightDeck
				name=			"Flight Deck"
				>

				<Panes>
					<Default>
						<OnPaneInit>
							(block (behavior)
								(setq behavior (objGetData gSource "behavior"))
								(setq gLevel (objGetData gPlayerShip "fleetLevel"))
								
								(switch
									(eq behavior 'moving)
										(scrSetDesc gScreen
											"You are on the flight deck of " (objGetName gSource 0x04) ". "
											"The ship is on maneuvers and the XO is giving orders to the navigator and the sensor chief."
											)
											
									(eq gLevel 1)
										(scrSetDesc gScreen
											"The flight deck of " (objGetName gSource 0x04) 
											" hums with the activity of men and women working at terminals and holocharts. "
											"The XO is giving orders to a squadron out on a mission."
											)

									(scrSetDesc gScreen
										"You are on the flight deck of " (objGetName gSource 0x04) ". "
										"Men and women work at terminals planning missions and communicating with squadrons on patrol. "
										"The XO is near a holochart, listening to a report."
										)
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Talk to Executive Officer" key="X">
								(block (behavior)
									(setq behavior (objGetData gSource "behavior"))
									(switch
										(eq behavior 'moving)
											(scrShowPane gScreen "ShipMoving")
										
										(block Nil
											(setq gPrevScreen "FlightDeck")
											(setq gPrevPane "Default")
											(setq gMissionTitle "Flight Deck")

											; Get the list of missions for this level. If the player is at level 3
											; and the scientist rescue mission has not been completed, then do that mission;
											; otherwise, do a mission appropriate for the level

											(if (and (geq (objGetData gPlayerShip "fleetLevel") 3)
													(not (typGetGlobalData &scCSCTerra; "p262scientists"))
													)
												(setq gMissionListName "MissionRescueScientists")
												(setq gMissionListName (cat "Missions" (objGetData gPlayerShip "fleetLevel")))
												)

											; Set some other parameters for the mission screen

											(if (gr (objGetData gPlayerShip "fleetTFSuccess") 0)
												(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
												(setq gMissionNoneText "\"Sorry, there are no missions available for you.\"")
												)
											(setq gMissionAcceptText (plyComposeString gPlayer "\"Good luck, %name%!\""))
											(setq gMissionDeclineText "\"Get the hell out of here then!\"")
											(scrShowScreen gScreen "&dsMission;")
											)
										)
									)
							</Action>

							<Action name="Leave" cancel="1" key="L">
								<Navigate screen="Main"/>
							</Action>
						</Actions>
					</Default>
					
					<ShipMoving>
						<OnPaneInit>
							(scrSetDesc gScreen
								"The XO is too busy to talk to you right now. He waves you away while he concentrates on the maneuvers."
								)
						</OnPaneInit>
						
						<Actions>
							<Action name="Leave" default="1" cancel="1" key="L">
								(scrShowScreen gScreen "Main")
							</Action>
						</Actions>
					</ShipMoving>
				</Panes>
			</FlightDeck>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="70" />
			<Port x="0"		y="-70" />
			<Port x="50"	y="50" />
			<Port x="50"	y="-50" />
			<Port x="70"	y="0" />
			<Port x="-70"	y="0" />
			<Port x="-50"	y="50" />
			<Port x="-50"	y="-50" />
		</DockingPorts>

	</ShipClass>

	<!-- CSC Hospital -->

	<ShipClass UNID="&scCSCHospital;"
			manufacturer=		""
			class=				"Commonwealth Star Carrier"
			type=				""
			score=				"2330"

			mass=				"50000"
			cargoSpace=			"5000"
			thrustRatio=        "0.5"
			maxSpeed=			"2"

			cyberDefenseLevel=	"6"
			explosionType=		"&vtThermoExplosion4;"
			leavesWreck=		"100"

			attributes=			"capitalShip, commonwealth, commonwealthFleet, commonwealthMilitary, fleetLaw, majorShip"

			dockScreen=			"Main"
			defaultBackgroundID="&rsCSCBkgnd;"

			inherit=			"&baCSCBase;"
			>

		<Armor
			armorID=			"&itP1000HexphaseArmor;"
			count=				"20"
			/>

		<Devices>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" minFireArc="270" maxFireArc="90"  posAngle="0" posRadius="64"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" minFireArc="90"  maxFireArc="270" posAngle="180" posRadius="64"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" omnidirectional="true" posAngle="90" posRadius="44"/>
			<Device deviceID="&itTeV9Blaster;" secondaryWeapon="true" omnidirectional="true" posAngle="270" posRadius="44"/>
			
			<Device deviceID="&itTeV9PD;"  posAngle="0" posRadius="30"/>
			<Device deviceID="&itTeV9PD;" posAngle="180" posRadius="30"/>
			<Device deviceID="&vtDamageControlParty;"/>
			<Device deviceID="&vtDamageControlParty;"/>
		</Devices>
		
		 <Interior>
                        <Compartment name="interior"
                                        hitPoints=        "400"
                                        />
                        
                        <Compartment name="main drive"
                                        type=                "mainDrive"
                                        hitPoints=        "200"

                                        posX=                "-56"
                                        posY=                "0"
                                        sizeX=                "42"
                                        sizeY=                "60"
                                        />
                </Interior>

		<Items>
			<Item				count="6d12"	item="&itPteracniumFuelRod;"/>
		</Items>

		<Image imageID="&rsLargeShips2;" imageX="0" imageY="0" imageWidth="256" imageHeight="256" />
		
		<Maneuver
			rotationCount=		"20"
			maxRotationRate=	"1"
			rotationAccel=		"0.1"
			/>
		<Effects>
			<Effect type="thrustMain"		posAngle="170"	posRadius="75"	posZ="-5"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="180"	posRadius="74"	posZ="-5"	rotation="180"	effect="&efMainThrusterLarge;"/>
			<Effect type="thrustMain"		posAngle="-170"	posRadius="75"	posZ="-5"	rotation="180"	effect="&efMainThrusterLarge;"/>
		</Effects>

		<AISettings
			fireRateAdj=		"10"
			fireAccuracy=		"95"
			perception=			"4"
			noFriendlyFire=		"true"
			/>

		<StaticData>
			<arcticaCaptainWelcome>
				(
					"The captain of the CSC Arctica welcomes you aboard: \"How are things going back in the Commonwealth? I haven't been to St. Katharine's in more than five years&#x97;had an amazing time at this little bar in the inner system. You really should check it out&#x97;if you make it back, I mean.\""
					)
			</arcticaCaptainWelcome>

			<arcticaGiftTable>
				(	; donation	item						count	unique
					(10000		&itPlasmaShieldGenerator;	1		'Gift1)
					(5000		&itInvincibleDeflector;		1		'Gift2)
					(2500		&itR5Deflector;				1		'Gift3)
					(1250		&itEMPImmuneCoating;		4		'Gift4)
					(0			&itKobeWater;				1		Nil)
					)
			</arcticaGiftTable>

			<saharaCaptainWelcome>
				(
					"The captain of the CSC Sahara welcomes you aboard: \"I hope you will be able to help our good doctor to obtain medical supplies. This damn war has made more invalids than heroes.\""
					)
			</saharaCaptainWelcome>

			<saharaGiftTable>
				(	; donation	item						count	unique
					(10000		&itMammoth100Deflector;		1		'Gift1)
					(5000		&itBlueEtheriumCrystal;		1		'Gift2)
					(2500		&itPatchSpider;				1		'Gift3)
					(1250		&itR1Deflector;				1		'Gift4)
					(0			&itEuropanIceVodka;			1		Nil)
					)
			</saharaGiftTable>
		</StaticData>

		<DockScreens>
			<Main>
				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (cat "You are in the docking bay of the " (objGetName gSource) "."))
						</OnPaneInit>

						<Actions>
							<Action name="Bridge" key="B">
								(block Nil
									(scrShowScreen gScreen "Bridge")
								
									; If see if we got promoted
									(if (intFleetPromotion)
										(block Nil
											(setq gName Nil)
											(scrShowScreen gScreen "&dsFleetPromotion;")
											)
										)
									)
							</Action>

							<Action name="Infirmary" key="I">
								<Navigate screen="Infirmary"/>
							</Action>

							<Action name="Dock Services" key="D">
								(scrShowScreen gScreen "&dsFleetDockServices;")
							</Action>

							<Action name="Undock" cancel="1" key="U">
								<Exit/>
							</Action>

						</Actions>

					</Default>
				</Panes>

			</Main>

			<Bridge
				name=			"Bridge"
				>

				<Panes>
					<Default>
						<OnPaneInit>
							(scrSetDesc gScreen (intRandomMessage gSource (cat (objGetData gSource "CSC") "CaptainWelcome") "arcticaCaptainWelcome"))
						</OnPaneInit>

						<Actions>
							<Action name="Leave" cancel="1" key="L">
								<Navigate screen="Main"/>
							</Action>
						</Actions>
					</Default>
				</Panes>

			</Bridge>

			<Infirmary
				name=			"Infirmary"
				>

				<Panes>
					<Default
							desc=	"You are in the main infirmary of a Commonwealth Star Carrier. Sleep-deprived technicians attend hundreds of patients in their rejuv tanks, mostly oblivious to the insistent medical alarms. The smell of blood, wounds, and antiseptics smother you.">

						<Actions>
							<Action name="Talk to Medical Officer" key="M">
								(block Nil
									; See if the player has any medical supplies
									(setq gItem (objGetItems gPlayerShip "*U+Meds"))

									(if gItem
										(scrShowPane gScreen "SellMedicalItems")
										(scrShowPane gScreen "NoMedicalItems")
										)
									)
							</Action>

							<!--
							<Action name="Talk to patient" key="P">
								</Action>
								-->

							<Action name="Leave" cancel="1" key="L">
								<Navigate screen="Main"/>
							</Action>

						</Actions>

					</Default>

					<NoMedicalItems
							desc=	"The Medical Officer complains about how hard it is to get medical supplies this deep in space. &quot;We're getting killed out here fighting the Ares and this is how the Commonwealth thanks us&#x97;no supplies, no reinforcements, nothing!&quot;">

						<Actions>
							<Action name="Leave" default="1" cancel="1" key="L">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>

					</NoMedicalItems>

					<SellMedicalItems>
						<OnPaneInit>
							(block (medicalItem)
								; Figure out how much all the supplies cost
								(setq gCost 0)
								(enum gItem medicalItem
									(setq gCost 
										(add gCost 
											; Offer 25% more
											(divide (multiply 125 (itmGetPrice medicalItem 'credit) (itmGetCount medicalItem)) 100)
											)
										)
									)

								; Set the description
								(if (eq (count gItem) 1)
									; Only one item
									(scrSetDesc gScreen 
										"\"Welcome to the Infirmary, %sir%! We are in desperate need of medical supplies. "
										"I'm prepared to offer you " gCost " credits for the " (itmGetName (item gItem 0) 16) " in your cargo hold. "
										"What do you say?\""
										)

									; Multiple items
									(block (medicalItem itemListDesc)
										(enum gItem medicalItem
											(if itemListDesc
												(setq itemListDesc (cat itemListDesc ", " (itmGetName medicalItem 8)))
												(setq itemListDesc (cat "(" (itmGetName medicalItem 8)))
												)
											)

										(setq itemListDesc (cat itemListDesc ")"))

										(scrSetDesc gScreen 
											"\"Welcome to the Infirmary, %sir%! We are in desperate need of medical supplies. "
											"I'm prepared to offer you " gCost " credits for all the medical items in your cargo hold: " itemListDesc 
											". What do you say?\""
											)
										)
									)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Sell items" default="1" key="S">
								(block (medicalItem)
									; Remove the items from the cargo hold
									(enum gItem medicalItem
										(block Nil
											(objRemoveItem gPlayerShip medicalItem)
											(plyRecordSellItem gPlayer medicalItem 
												(divide (multiply 125 (itmGetPrice medicalItem 'credit) (itmGetCount medicalItem)) 100)
												)
											)
										)

									; Pay the player
									(plyCredit gPlayer gCost)

									; Done
									(scrShowPane gScreen "DoneSelling")
									)
							</Action>

							<Action name="Donate items" key="D">
								(block (medicalItems)
									; Remove the items from the cargo hold
									(enum gItem medicalItem
										(objRemoveItem gPlayerShip medicalItem)
										)
										
									; Keep track of how much we donate
									(typIncGlobalData &svCommonwealthFleet; "medsDonated" gCost)

									; Player gets a gift depending on how much she donated
									(scrShowPane gScreen "Donate")
									)
							</Action>

							<Action name="Leave" cancel="1" key="L">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>

					</SellMedicalItems>

					<DoneSelling
							desc=	"&quot;Thank you, those supplies are really going to help these troopers.&quot;">

						<Actions>
							<Action name="Leave" default="1" cancel="1" key="L">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>

					</DoneSelling>

					<Donate>
						<OnPaneInit>
							(block (gift giftTable fleetXP xpGain maxGain)
								; Get the gift table
								(setq giftTable (objGetStaticData gSource (cat (objGetData gSource "CSC") "GiftTable")))
								(if (not giftTable)
									(setq giftTable (objGetStaticData gSource "arcticaGiftTable"))
									)

								; Find the appropriate gift based on the donation. The donation amount
								; must be greater than the minimum for the gift and the gift must have
								; not been given before (or the gift must not be unique).
								(setq gift Nil)
								(enumwhile giftTable (not gift) thisEntry
									(if (and (geq gCost (item thisEntry 0))
											(or (not (item thisEntry 3)) (not (objGetData gSource (item thisEntry 3))))
											)
										(block Nil
											(setq gift (itmCreate (item thisEntry 1) (item thisEntry 2)))

											; Do not give this gift again
											(if (item thisEntry 3)
												(objSetData gSource (item thisEntry 3) True)
												)
											)
										)
									)

								; Describe the gift
								(scrSetDesc gScreen (cat "\"Your generosity humbles me! When I was posted in the front-lines I came across " (itmGetName gift 8) ". I would be honored if you would accept it as a gift.\""))

								; Give the gift to the player
								(objAddItem gPlayerShip gift)

								; Figure out how much experience we could gain. We cannot gain more than
								; 200xp or xp beyond 600 (Master Sergeant).
								(setq fleetXP (objGetData gPlayerShip "fleetXP"))
								(switch
									(geq fleetXP 600)
										(setq maxGain 0)

									(geq fleetXP 400)
										(setq maxGain (subtract 600 fleetXP))

									(setq maxGain 200)
									)

								; Player gains experience at the rate of 1 xp per 10 credits
								; up to a maximum
								(setq xpGain (divide gCost 10))
								(if (gr xpGain maxGain)
									(setq xpGain maxGain)
									)

								(objIncData gPlayerShip "fleetXP" xpGain)
								)
						</OnPaneInit>

						<Actions>
							<Action name="Done" default="1" cancel="1" key="D">
								<ShowPane pane="Default"/>
							</Action>
						</Actions>
					</Donate>

				</Panes>

			</Infirmary>

		</DockScreens>

		<DockingPorts>
			<Port x="0"		y="70" />
			<Port x="0"		y="-70" />
			<Port x="50"	y="50" />
			<Port x="50"	y="-50" />
			<Port x="70"	y="0" />
			<Port x="-70"	y="0" />
			<Port x="-50"	y="50" />
			<Port x="-50"	y="-50" />
		</DockingPorts>
		</ShipClass>
</TranscendenceModule>